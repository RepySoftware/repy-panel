(self.webpackChunkseigas_repy_panel=self.webpackChunkseigas_repy_panel||[]).push([[328],{44836:function(e,t,n){!function(e,t,n){"use strict";var o=function(e){e&&Object.assign(this,e)},r=function(){function t(e,t){this.el=e,this.ngZone=t,this.onAddressChange=new n.EventEmitter}return t.prototype.ngAfterViewInit=function(){this.options||(this.options=new o),this.initialize()},t.prototype.isGoogleLibExists=function(){return!(!google||!google.maps||!google.maps.places)},t.prototype.initialize=function(){var e=this;if(!this.isGoogleLibExists())throw new Error("Google maps library can not be found");if(this.autocomplete=new google.maps.places.Autocomplete(this.el.nativeElement,this.options),!this.autocomplete)throw new Error("Autocomplete is not initialized");null!=!this.autocomplete.addListener&&(this.eventListener=this.autocomplete.addListener("place_changed",function(){e.handleChangeEvent()})),this.el.nativeElement.addEventListener("keydown",function(t){t.key&&"enter"==t.key.toLowerCase()&&t.target===e.el.nativeElement&&(t.preventDefault(),t.stopPropagation())}),window&&window.navigator&&window.navigator.userAgent&&navigator.userAgent.match(/(iPad|iPhone|iPod)/g)&&setTimeout(function(){var e=document.getElementsByClassName("pac-container");if(e){var t=Array.from(e);if(t)for(var n=0,o=t;n<o.length;n++){var r=o[n];r&&r.addEventListener("touchend",function(e){e.stopImmediatePropagation()})}}},500)},t.prototype.reset=function(){this.autocomplete.setComponentRestrictions(this.options.componentRestrictions),this.autocomplete.setTypes(this.options.types)},t.prototype.handleChangeEvent=function(){var e=this;this.ngZone.run(function(){e.place=e.autocomplete.getPlace(),e.place&&e.onAddressChange.emit(e.place)})},t.ctorParameters=function(){return[{type:n.ElementRef},{type:n.NgZone}]},t.propDecorators={options:[{type:n.Input,args:["options"]}],onAddressChange:[{type:n.Output}]},t.\u0275fac=function(n){return new(n||t)(e.\u0275\u0275directiveInject(e.ElementRef),e.\u0275\u0275directiveInject(e.NgZone))},t.\u0275dir=e.\u0275\u0275defineDirective({type:t,selectors:[["","ngx-google-places-autocomplete",""]],inputs:{options:"options"},outputs:{onAddressChange:"onAddressChange"},exportAs:["ngx-places"]}),t}(),a=function(){function t(){}return t.ctorParameters=function(){return[]},t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=e.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=e.\u0275\u0275defineInjector({}),t}();t.GooglePlaceModule=a,t.GooglePlaceDirective=r,Object.defineProperty(t,"__esModule",{value:!0})}(n(37716),t,n(37716))},62328:function(e,t,n){"use strict";n.r(t),n.d(t,{StockModule:function(){return We}});var o=n(38583),r=n(54655),a=n(3679),i=n(22238),s=n(37716),l=n(38555),c=n(84465),d=n(37499),m=n(78451),p=n(98295),u=n(49983),h=n(67441),f=n(51095),v=n(71419),g=n(72458);function S(e,t){1&e&&s["\u0275\u0275element"](0,"button-dialog-close")}function E(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"h3",12),s["\u0275\u0275text"](1,"Novo dep\xf3sito"),s["\u0275\u0275elementEnd"]())}function y(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"h3",12),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){const e=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"]("Edi\xe7\xe3o ",e.deposit.name,"")}}function I(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"mat-error"),s["\u0275\u0275text"](1," Este campo \xe9 obrigat\xf3rio "),s["\u0275\u0275elementEnd"]())}function b(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"mat-option",13),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275property"]("value",e.id),s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"](" ",e.name," ")}}function w(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"mat-error"),s["\u0275\u0275text"](1," Este campo \xe9 obrigat\xf3rio "),s["\u0275\u0275elementEnd"]())}let x=(()=>{class e{constructor(e,t,n,o,r,a){this._loader=e,this._toast=t,this._depositService=n,this._companyBranchService=o,this._dialogRef=r,this.inputData=a,this.companyBranches=[],this.initForm()}ngOnInit(){this.getCompanyBranches(),this.inputData.depositId&&this.getDeposit().then(()=>this.setFormValues())}initForm(){this.depositForm=new a.cw({name:new a.NI(null,a.kI.required),companyBranch:new a.NI(null,a.kI.required)})}setFormValues(){this.depositForm.get("name").setValue(this.deposit.name),this.depositForm.get("companyBranch").setValue(this.deposit.companyBranch.id)}getDeposit(){return new Promise((e,t)=>{this._loader.show(),this._depositService.getById(this.inputData.depositId).subscribe(t=>{this._loader.dismiss(),this.deposit=t,e(t)},e=>{this._loader.dismiss(),this._toast.showHttpError(e),t(e)})})}getCompanyBranches(){this._companyBranchService.getAll().subscribe(e=>{this.companyBranches=e},e=>{this._toast.showHttpError(e)})}save(){if(!this.depositForm.valid)throw this.depositForm.markAllAsTouched(),this._toast.open("Preencha todos os campos obrigat\xf3rios"),new Error("Invalid form");const e={name:this.depositForm.get("name").value,companyBranchId:this.depositForm.get("companyBranch").value};let t;this.deposit?(e.id=this.deposit.id,t=this._depositService.update(e)):t=this._depositService.create(e),this._loader.show(),t.subscribe(e=>{this._loader.dismiss(),this._toast.open("Salvo com sucesso!","success"),this.deposit=e,this.initForm(),this.setFormValues(),this._dialogRef.close({hasUpdate:!0})},e=>{this._loader.dismiss(),this._toast.showHttpError(e)})}get isModal(){return!!this.inputData}}return e.\u0275fac=function(t){return new(t||e)(s["\u0275\u0275directiveInject"](l.D),s["\u0275\u0275directiveInject"](c.k),s["\u0275\u0275directiveInject"](d.s),s["\u0275\u0275directiveInject"](m._),s["\u0275\u0275directiveInject"](i.so),s["\u0275\u0275directiveInject"](i.WI))},e.\u0275cmp=s["\u0275\u0275defineComponent"]({type:e,selectors:[["app-deposit-form"]],decls:25,vars:7,consts:[[4,"ngIf"],[1,"row"],[1,"col-sm-12"],["class","title",4,"ngIf"],[3,"formGroup"],[1,"col-12"],["matInput","","placeholder","Nome","autocomplete","off","formControlName","name"],["name",""],["formControlName","companyBranch"],["type",""],[3,"value",4,"ngFor","ngForOf"],["mat-flat-button","","color","primary",2,"margin","24px 0",3,"click"],[1,"title"],[3,"value"]],template:function(e,t){if(1&e&&(s["\u0275\u0275template"](0,S,1,0,"button-dialog-close",0),s["\u0275\u0275elementStart"](1,"div",1),s["\u0275\u0275elementStart"](2,"div",2),s["\u0275\u0275template"](3,E,2,0,"h3",3),s["\u0275\u0275template"](4,y,2,1,"h3",3),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](5,"form",4),s["\u0275\u0275elementStart"](6,"div",1),s["\u0275\u0275elementStart"](7,"div",5),s["\u0275\u0275elementStart"](8,"mat-form-field"),s["\u0275\u0275element"](9,"input",6,7),s["\u0275\u0275template"](11,I,2,0,"mat-error",0),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](12,"div",5),s["\u0275\u0275elementStart"](13,"mat-form-field"),s["\u0275\u0275elementStart"](14,"mat-label"),s["\u0275\u0275text"](15,"Unidade"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](16,"mat-select",8,9),s["\u0275\u0275template"](18,b,2,2,"mat-option",10),s["\u0275\u0275elementEnd"](),s["\u0275\u0275template"](19,w,2,0,"mat-error",0),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](20,"hr"),s["\u0275\u0275elementStart"](21,"div",1),s["\u0275\u0275elementStart"](22,"div",2),s["\u0275\u0275elementStart"](23,"button",11),s["\u0275\u0275listener"]("click",function(){return t.save()}),s["\u0275\u0275text"](24,"Salvar"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&e){const e=s["\u0275\u0275reference"](10);s["\u0275\u0275property"]("ngIf",t.isModal),s["\u0275\u0275advance"](3),s["\u0275\u0275property"]("ngIf",!t.deposit),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf",t.deposit),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("formGroup",t.depositForm),s["\u0275\u0275advance"](6),s["\u0275\u0275property"]("ngIf",!e.valid),s["\u0275\u0275advance"](7),s["\u0275\u0275property"]("ngForOf",t.companyBranches),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf",!t.depositForm.get("companyBranch").valid)}},directives:[o.O5,a._Y,a.JL,a.sg,p.KE,u.Nt,a.Fj,a.JJ,a.u,p.hX,h.gD,o.sg,f.lW,v.P,p.TO,g.ey],styles:[""]}),e})();var _=n(26026),C=n(32789),P=n(76627);function k(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"th",11),s["\u0275\u0275text"](1,"#"),s["\u0275\u0275elementEnd"]())}function O(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"td",12),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate"](e.id)}}function D(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"th",11),s["\u0275\u0275text"](1,"Nome"),s["\u0275\u0275elementEnd"]())}function F(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"td",12),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"](" ",e.name," ")}}function B(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"th",11),s["\u0275\u0275text"](1,"Unidade"),s["\u0275\u0275elementEnd"]())}function M(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"td",12),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"](" ",e.companyBranch.name," ")}}function j(e,t){1&e&&s["\u0275\u0275element"](0,"th",11)}function A(e,t){if(1&e){const e=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"td",12),s["\u0275\u0275elementStart"](1,"a",13),s["\u0275\u0275listener"]("click",function(){const t=s["\u0275\u0275restoreView"](e).$implicit;return s["\u0275\u0275nextContext"]().openForm(t.id)}),s["\u0275\u0275elementStart"](2,"mat-icon"),s["\u0275\u0275text"](3,"edit"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()}}function T(e,t){1&e&&s["\u0275\u0275element"](0,"tr",14)}function N(e,t){1&e&&s["\u0275\u0275element"](0,"tr",15)}let q=(()=>{class e{constructor(e,t,n,o,r){this._loader=e,this._toast=t,this._depositService=n,this._dialog=o,this._title=r,this.deposits=[],this.tableColumns=["id","name","companyBranch","options"]}ngOnInit(){this._title.set("Dep\xf3sitos"),this.getDeposits()}getDeposits(){return new Promise((e,t)=>{this._loader.show(),this._depositService.getAll().subscribe(t=>{this._loader.dismiss(),this.deposits=t,e()},e=>{this._loader.dismiss(),this._toast.showHttpError(e),t()})})}openForm(e){this._dialog.open(x,{width:"90%",height:"90%",data:{depositId:e}}).afterClosed().subscribe(e=>{e&&e.hasUpdate&&this.getDeposits()})}}return e.\u0275fac=function(t){return new(t||e)(s["\u0275\u0275directiveInject"](l.D),s["\u0275\u0275directiveInject"](c.k),s["\u0275\u0275directiveInject"](d.s),s["\u0275\u0275directiveInject"](i.uw),s["\u0275\u0275directiveInject"](_.y))},e.\u0275cmp=s["\u0275\u0275defineComponent"]({type:e,selectors:[["app-deposits"]],decls:20,vars:3,consts:[[2,"font-size","32px","margin","16px"],["mat-table","",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","companyBranch"],["matColumnDef","options"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["href","javascript:;","mat-fab","","color","primary",1,"btn-add",3,"click"],["mat-header-cell",""],["mat-cell",""],["href","javascript:;",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"h1",0),s["\u0275\u0275text"](1,"Dep\xf3sitos"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](2,"table",1),s["\u0275\u0275elementContainerStart"](3,2),s["\u0275\u0275template"](4,k,2,0,"th",3),s["\u0275\u0275template"](5,O,2,1,"td",4),s["\u0275\u0275elementContainerEnd"](),s["\u0275\u0275elementContainerStart"](6,5),s["\u0275\u0275template"](7,D,2,0,"th",3),s["\u0275\u0275template"](8,F,2,1,"td",4),s["\u0275\u0275elementContainerEnd"](),s["\u0275\u0275elementContainerStart"](9,6),s["\u0275\u0275template"](10,B,2,0,"th",3),s["\u0275\u0275template"](11,M,2,1,"td",4),s["\u0275\u0275elementContainerEnd"](),s["\u0275\u0275elementContainerStart"](12,7),s["\u0275\u0275template"](13,j,1,0,"th",3),s["\u0275\u0275template"](14,A,4,0,"td",4),s["\u0275\u0275elementContainerEnd"](),s["\u0275\u0275template"](15,T,1,0,"tr",8),s["\u0275\u0275template"](16,N,1,0,"tr",9),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](17,"button",10),s["\u0275\u0275listener"]("click",function(){return t.openForm()}),s["\u0275\u0275elementStart"](18,"mat-icon"),s["\u0275\u0275text"](19,"add"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&e&&(s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("dataSource",t.deposits),s["\u0275\u0275advance"](13),s["\u0275\u0275property"]("matHeaderRowDef",t.tableColumns),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("matRowDefColumns",t.tableColumns))},directives:[C.BZ,C.w1,C.fO,C.Dz,C.as,C.nj,f.lW,P.Hw,C.ge,C.ev,C.XQ,C.Gk],styles:["table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:64px;background:#eee;z-index:10}.btn-add[_ngcontent-%COMP%]{position:fixed;bottom:26px;right:30px}"]}),e})();var $=n(88002),L=n(16738),H=n(83188),V=n(66082),R=n(54822),G=n(7539);function Y(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"mat-option",22),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275property"]("value",e.id),s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"](" ",e.name," ")}}function z(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"mat-error"),s["\u0275\u0275text"](1," Este campo \xe9 obrigat\xf3rio "),s["\u0275\u0275elementEnd"]())}function U(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"mat-option",22),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275property"]("value",e.id),s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"](" ",e.name," ")}}function J(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"mat-error"),s["\u0275\u0275text"](1," Este campo \xe9 obrigat\xf3rio "),s["\u0275\u0275elementEnd"]())}function W(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"mat-error"),s["\u0275\u0275text"](1," Este campo \xe9 obrigat\xf3rio "),s["\u0275\u0275elementEnd"]())}function Q(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"mat-error"),s["\u0275\u0275text"](1," Este campo \xe9 obrigat\xf3rio "),s["\u0275\u0275elementEnd"]())}const X=function(){return{standalone:!0}};function Z(e,t){if(1&e){const e=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"mat-checkbox",24),s["\u0275\u0275listener"]("ngModelChange",function(t){return s["\u0275\u0275restoreView"](e).$implicit.selected=t}),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit;s["\u0275\u0275property"]("ngModel",e.selected)("ngModelOptions",s["\u0275\u0275pureFunction0"](4,X)),s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate2"](" ",e.product.product.name," (",e.product.product.code,") ")}}function K(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"div",1),s["\u0275\u0275elementStart"](1,"h4"),s["\u0275\u0275text"](2,"Incluir tamb\xe9m:"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](3,"div"),s["\u0275\u0275template"](4,Z,2,5,"mat-checkbox",23),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&e){const e=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](4),s["\u0275\u0275property"]("ngForOf",e.relatedProducts)}}let ee=(()=>{class e{constructor(e,t,n,o,r,a,i){this._toast=e,this._loader=t,this._stockService=n,this._productService=o,this._depositService=r,this._dialogRef=a,this.inputData=i,this.productSearchAutocompleteOptions={placeholder:"Produto",onGetItems:e=>this.productSearchAutocompleteOnGetItems(e),onSelectItem:e=>this.productSearchAutocompleteOnSelectItem(e),emitOnClear:!0},this.deposits=[],this.relatedProducts=[],this.initForm()}ngOnInit(){this.getDeposits()}initForm(){this.depositTransferForm=new a.cw({originDeposit:new a.NI(null,a.kI.required),destinationDeposit:new a.NI(null,a.kI.required),companyBranchProduct:new a.NI(null,a.kI.required),quantity:new a.NI(null,[a.kI.required,a.kI.min(1)]),dateOfIssue:new a.NI(L().format("YYYY-MM-DDTHH:mm"),a.kI.required),observation:new a.NI(null)})}getDeposits(){this._loader.show(),this._depositService.getAll({companyBranchId:this.inputData.companyBranchId}).subscribe(e=>{this._loader.dismiss(),this.deposits=e},e=>{this._loader.dismiss(),this._toast.showHttpError(e)})}productSearchAutocompleteOnGetItems(e){return this._productService.getAllForSales({index:0,limit:8,q:e},this.inputData.companyBranchId).pipe((0,$.U)(e=>e.map(e=>({label:`${e.product.code} - ${e.product.name}`,value:e}))))}productSearchAutocompleteOnSelectItem(e){var t;this.selectedProduct=e.value,this.depositTransferForm.get("companyBranchProduct").setValue((null===(t=e.value)||void 0===t?void 0:t.id)||null),this.selectedProduct?this.getRelatedProducts():this.relatedProducts=[]}getRelatedProducts(){this._productService.getRelated(this.selectedProduct.id).subscribe(e=>{this.relatedProducts=e.map(e=>({product:e.referencedCompanyBranchProduct,selected:e.isDefault}))},e=>{this._toast.showHttpError(e)})}transfer(){if(!this.depositTransferForm.valid)throw this.depositTransferForm.markAllAsTouched(),this._toast.open("Preencha todos os campos obrigat\xf3rios"),new Error("Invalid form");const e=this.depositTransferForm.get("originDeposit").value,t=this.depositTransferForm.get("destinationDeposit").value,n=this.depositTransferForm.get("companyBranchProduct").value,o=this.depositTransferForm.get("quantity").value,r=L(this.depositTransferForm.get("dateOfIssue").value).toISOString(),a=this.depositTransferForm.get("observation").value,i=[{originDepositId:e,destinationDepositId:t,companyBranchProductId:n,quantity:o,dateOfIssue:r,observation:a},...this.relatedProducts.filter(e=>e.selected).map(n=>({originDepositId:e,destinationDepositId:t,companyBranchProductId:n.product.id,quantity:o,dateOfIssue:r,observation:`[Rel.] ${a||""}`}))];this._loader.show(),this._stockService.depositTransfer(i).subscribe(e=>{this._loader.dismiss(),this._toast.open("Transfer\xeancia conclu\xedda","success"),this._dialogRef.close()},e=>{this._loader.dismiss(),this._toast.showHttpError(e),this._dialogRef.close({hasUpdate:!0})})}}return e.\u0275fac=function(t){return new(t||e)(s["\u0275\u0275directiveInject"](c.k),s["\u0275\u0275directiveInject"](l.D),s["\u0275\u0275directiveInject"](H.q),s["\u0275\u0275directiveInject"](V.M),s["\u0275\u0275directiveInject"](d.s),s["\u0275\u0275directiveInject"](i.so),s["\u0275\u0275directiveInject"](i.WI))},e.\u0275cmp=s["\u0275\u0275defineComponent"]({type:e,selectors:[["app-deposit-transfer"]],decls:46,vars:9,consts:[[1,"row"],[1,"col-sm-12"],[1,"title"],[3,"formGroup"],[1,"col-md-6"],["formControlName","originDeposit"],["type",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["formControlName","destinationDeposit"],[1,"col-12"],[3,"options"],["productAutocomplete",""],["matInput","","placeholder","Quantidade","type","number","autocomplete","off","formControlName","quantity"],["quantity",""],["matInput","","type","datetime-local","placeholder","Data","autocomplete","off","formControlName","dateOfIssue"],["dateOfIssue",""],[1,"col-md-12"],["matInput","","placeholder","Observa\xe7\xe3o","autocomplete","off","formControlName","observation"],["observation",""],["class","col-sm-12",4,"ngIf"],["mat-flat-button","","color","primary",2,"margin","24px 0",3,"click"],[3,"value"],[3,"ngModel","ngModelOptions","ngModelChange",4,"ngFor","ngForOf"],[3,"ngModel","ngModelOptions","ngModelChange"]],template:function(e,t){if(1&e&&(s["\u0275\u0275element"](0,"button-dialog-close"),s["\u0275\u0275elementStart"](1,"div",0),s["\u0275\u0275elementStart"](2,"div",1),s["\u0275\u0275elementStart"](3,"h3",2),s["\u0275\u0275text"](4,"Transfer\xeancia de estoque"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](5,"form",3),s["\u0275\u0275elementStart"](6,"div",0),s["\u0275\u0275elementStart"](7,"div",4),s["\u0275\u0275elementStart"](8,"mat-form-field"),s["\u0275\u0275elementStart"](9,"mat-label"),s["\u0275\u0275text"](10,"Dep\xf3sito origem"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](11,"mat-select",5,6),s["\u0275\u0275template"](13,Y,2,2,"mat-option",7),s["\u0275\u0275elementEnd"](),s["\u0275\u0275template"](14,z,2,0,"mat-error",8),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](15,"div",4),s["\u0275\u0275elementStart"](16,"mat-form-field"),s["\u0275\u0275elementStart"](17,"mat-label"),s["\u0275\u0275text"](18,"Dep\xf3sito destino"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](19,"mat-select",9,6),s["\u0275\u0275template"](21,U,2,2,"mat-option",7),s["\u0275\u0275elementEnd"](),s["\u0275\u0275template"](22,J,2,0,"mat-error",8),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](23,"div",10),s["\u0275\u0275element"](24,"app-autocomplete",11,12),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](26,"div",4),s["\u0275\u0275elementStart"](27,"mat-form-field"),s["\u0275\u0275element"](28,"input",13,14),s["\u0275\u0275template"](30,W,2,0,"mat-error",8),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](31,"div",4),s["\u0275\u0275elementStart"](32,"mat-form-field"),s["\u0275\u0275element"](33,"input",15,16),s["\u0275\u0275template"](35,Q,2,0,"mat-error",8),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](36,"div",17),s["\u0275\u0275elementStart"](37,"mat-form-field"),s["\u0275\u0275element"](38,"input",18,19),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](40,"hr"),s["\u0275\u0275elementStart"](41,"div",0),s["\u0275\u0275template"](42,K,5,1,"div",20),s["\u0275\u0275elementStart"](43,"div",1),s["\u0275\u0275elementStart"](44,"button",21),s["\u0275\u0275listener"]("click",function(){return t.transfer()}),s["\u0275\u0275text"](45,"Transferir"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&e){const e=s["\u0275\u0275reference"](29),n=s["\u0275\u0275reference"](34);s["\u0275\u0275advance"](5),s["\u0275\u0275property"]("formGroup",t.depositTransferForm),s["\u0275\u0275advance"](8),s["\u0275\u0275property"]("ngForOf",t.deposits),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf",!t.depositTransferForm.get("originDeposit").valid),s["\u0275\u0275advance"](7),s["\u0275\u0275property"]("ngForOf",t.deposits),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf",!t.depositTransferForm.get("destinationDeposit").valid),s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("options",t.productSearchAutocompleteOptions),s["\u0275\u0275advance"](6),s["\u0275\u0275property"]("ngIf",!e.valid),s["\u0275\u0275advance"](5),s["\u0275\u0275property"]("ngIf",!n.valid),s["\u0275\u0275advance"](7),s["\u0275\u0275property"]("ngIf",null==t.relatedProducts?null:t.relatedProducts.length)}},directives:[v.P,a._Y,a.JL,a.sg,p.KE,p.hX,h.gD,a.JJ,a.u,o.sg,o.O5,R.Y,u.Nt,a.wV,a.Fj,f.lW,g.ey,p.TO,G.oG,a.On],styles:[""]}),e})();var te=(()=>(function(e){e.IN="IN",e.OUT="OUT",e.BALANCE="BALANCE"}(te||(te={})),te))();const ne={[te.IN]:"Entrada",[te.OUT]:"Sa\xedda",[te.BALANCE]:"Balan\xe7o"},oe={[te.IN]:"var(--color-nephritis)",[te.OUT]:"var(--color-peterriver)",[te.BALANCE]:"var(--color-wisteria)"};let re=(()=>{class e{transform(e){return function(e){return ne[e]}(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=s["\u0275\u0275definePipe"]({name:"stockPostType",type:e,pure:!0}),e})();function ae(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"mat-option",21),s["\u0275\u0275text"](1),s["\u0275\u0275pipe"](2,"stockPostType"),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275property"]("value",e),s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"](" ",s["\u0275\u0275pipeBind1"](2,2,e)," ")}}function ie(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"mat-error"),s["\u0275\u0275text"](1," Este campo \xe9 obrigat\xf3rio "),s["\u0275\u0275elementEnd"]())}function se(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"mat-error"),s["\u0275\u0275text"](1," Este campo \xe9 obrigat\xf3rio "),s["\u0275\u0275elementEnd"]())}function le(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"mat-error"),s["\u0275\u0275text"](1," Este campo \xe9 obrigat\xf3rio "),s["\u0275\u0275elementEnd"]())}const ce=function(){return{standalone:!0}};function de(e,t){if(1&e){const e=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"mat-checkbox",23),s["\u0275\u0275listener"]("ngModelChange",function(t){return s["\u0275\u0275restoreView"](e).$implicit.selected=t}),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit;s["\u0275\u0275property"]("ngModel",e.selected)("ngModelOptions",s["\u0275\u0275pureFunction0"](4,ce)),s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate2"](" ",e.product.product.name," (",e.product.product.code,") ")}}function me(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"div",1),s["\u0275\u0275elementStart"](1,"h4"),s["\u0275\u0275text"](2,"Incluir tamb\xe9m:"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](3,"div"),s["\u0275\u0275template"](4,de,2,5,"mat-checkbox",22),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&e){const e=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](4),s["\u0275\u0275property"]("ngForOf",e.relatedProducts)}}let pe=(()=>{class e{constructor(e,t,n,o,r,a){this._loader=e,this._toast=t,this._dialogRef=n,this._stockService=o,this._productService=r,this.inputData=a,this.productSearchAutocompleteOptions={placeholder:"Produto",onGetItems:e=>this.productSearchAutocompleteOnGetItems(e),onSelectItem:e=>this.productSearchAutocompleteOnSelectItem(e),emitOnClear:!0},this.relatedProducts=[],this.stockPostTypes=Object.values(te),this.initForm()}ngOnInit(){}initForm(){this.stockForm=new a.cw({companyBranchProduct:new a.NI(null,a.kI.required),type:new a.NI(te.BALANCE,a.kI.required),quantity:new a.NI(null,[a.kI.required,a.kI.min(0)]),observation:new a.NI(null),dateOfIssue:new a.NI(L().format("YYYY-MM-DDTHH:mm"),a.kI.required)})}productSearchAutocompleteOnGetItems(e){return this._productService.getAllForSales({index:0,limit:8,q:e},this.inputData.companyBranchId).pipe((0,$.U)(e=>e.map(e=>({label:`${e.product.code} - ${e.product.name}`,value:e}))))}productSearchAutocompleteOnSelectItem(e){var t;this.selectedProduct=e.value,this.stockForm.get("companyBranchProduct").setValue((null===(t=e.value)||void 0===t?void 0:t.id)||null),this.selectedProduct?this.getRelatedProducts():this.relatedProducts=[]}getRelatedProducts(){this._productService.getRelated(this.selectedProduct.id).subscribe(e=>{this.relatedProducts=e.map(e=>({product:e.referencedCompanyBranchProduct,selected:e.isDefault}))},e=>{this._toast.showHttpError(e)})}save(){if(!this.stockForm.valid)throw this.stockForm.markAllAsTouched(),this._toast.open("Preencha todos os campos obrigat\xf3rios"),new Error("Invalid form");const e=this.stockForm.get("type").value,t=this.stockForm.get("quantity").value,n=this.inputData.depositId,o=L(this.stockForm.get("dateOfIssue").value).toISOString(),r=this.stockForm.get("observation").value,a=[{companyBranchProductId:this.selectedProduct.id,depositId:n,type:e,quantity:t,dateOfIssue:o,observation:r},...this.relatedProducts.filter(e=>e.selected).map(a=>({companyBranchProductId:a.product.id,depositId:n,type:e,quantity:t,dateOfIssue:o,observation:`[Rel.] ${r||""}`}))];this._loader.show(),this._stockService.createPosts(a).subscribe(e=>{this._loader.dismiss(),this._toast.open("Lan\xe7amento salvo!","success"),this._dialogRef.close({hasUpdate:!0})},e=>{this._loader.dismiss(),this._toast.showHttpError(e)})}}return e.\u0275fac=function(t){return new(t||e)(s["\u0275\u0275directiveInject"](l.D),s["\u0275\u0275directiveInject"](c.k),s["\u0275\u0275directiveInject"](i.so),s["\u0275\u0275directiveInject"](H.q),s["\u0275\u0275directiveInject"](V.M),s["\u0275\u0275directiveInject"](i.WI))},e.\u0275cmp=s["\u0275\u0275defineComponent"]({type:e,selectors:[["app-stock-post-form"]],decls:38,vars:7,consts:[[1,"row"],[1,"col-sm-12"],[1,"title"],[3,"formGroup"],[1,"col-12"],[3,"options"],["productAutocomplete",""],[1,"col-md-4"],["formControlName","type"],["type",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["matInput","","placeholder","Quantidade","type","number","autocomplete","off","formControlName","quantity"],["quantity",""],["matInput","","type","datetime-local","placeholder","Data","autocomplete","off","formControlName","dateOfIssue"],["dateOfIssue",""],[1,"col-md-12"],["matInput","","placeholder","Observa\xe7\xe3o","autocomplete","off","formControlName","observation"],["observation",""],["class","col-sm-12",4,"ngIf"],["mat-flat-button","","color","primary",2,"margin","24px 0",3,"click"],[3,"value"],[3,"ngModel","ngModelOptions","ngModelChange",4,"ngFor","ngForOf"],[3,"ngModel","ngModelOptions","ngModelChange"]],template:function(e,t){if(1&e&&(s["\u0275\u0275element"](0,"button-dialog-close"),s["\u0275\u0275elementStart"](1,"div",0),s["\u0275\u0275elementStart"](2,"div",1),s["\u0275\u0275elementStart"](3,"h3",2),s["\u0275\u0275text"](4,"Novo lan\xe7amento"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](5,"form",3),s["\u0275\u0275elementStart"](6,"div",0),s["\u0275\u0275elementStart"](7,"div",4),s["\u0275\u0275element"](8,"app-autocomplete",5,6),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](10,"div",7),s["\u0275\u0275elementStart"](11,"mat-form-field"),s["\u0275\u0275elementStart"](12,"mat-label"),s["\u0275\u0275text"](13,"Tipo"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](14,"mat-select",8,9),s["\u0275\u0275template"](16,ae,3,4,"mat-option",10),s["\u0275\u0275elementEnd"](),s["\u0275\u0275template"](17,ie,2,0,"mat-error",11),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](18,"div",7),s["\u0275\u0275elementStart"](19,"mat-form-field"),s["\u0275\u0275element"](20,"input",12,13),s["\u0275\u0275template"](22,se,2,0,"mat-error",11),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](23,"div",7),s["\u0275\u0275elementStart"](24,"mat-form-field"),s["\u0275\u0275element"](25,"input",14,15),s["\u0275\u0275template"](27,le,2,0,"mat-error",11),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](28,"div",16),s["\u0275\u0275elementStart"](29,"mat-form-field"),s["\u0275\u0275element"](30,"input",17,18),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](32,"hr"),s["\u0275\u0275elementStart"](33,"div",0),s["\u0275\u0275template"](34,me,5,1,"div",19),s["\u0275\u0275elementStart"](35,"div",1),s["\u0275\u0275elementStart"](36,"button",20),s["\u0275\u0275listener"]("click",function(){return t.save()}),s["\u0275\u0275text"](37,"Salvar"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&e){const e=s["\u0275\u0275reference"](21),n=s["\u0275\u0275reference"](26);s["\u0275\u0275advance"](5),s["\u0275\u0275property"]("formGroup",t.stockForm),s["\u0275\u0275advance"](3),s["\u0275\u0275property"]("options",t.productSearchAutocompleteOptions),s["\u0275\u0275advance"](8),s["\u0275\u0275property"]("ngForOf",t.stockPostTypes),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf",!t.stockForm.get("type").valid),s["\u0275\u0275advance"](5),s["\u0275\u0275property"]("ngIf",!e.valid),s["\u0275\u0275advance"](5),s["\u0275\u0275property"]("ngIf",!n.valid),s["\u0275\u0275advance"](7),s["\u0275\u0275property"]("ngIf",null==t.relatedProducts?null:t.relatedProducts.length)}},directives:[v.P,a._Y,a.JL,a.sg,R.Y,p.KE,p.hX,h.gD,a.JJ,a.u,o.sg,o.O5,u.Nt,a.wV,a.Fj,f.lW,g.ey,p.TO,G.oG,a.On],pipes:[re],styles:[""]}),e})();var ue=n(75355),he=n(11436);let fe=(()=>{class e{transform(e){return function(e){return oe[e]}(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=s["\u0275\u0275definePipe"]({name:"stockPostTypeColor",type:e,pure:!0}),e})();var ve=n(26835);function ge(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"th",27),s["\u0275\u0275text"](1,"Produto"),s["\u0275\u0275elementEnd"]())}function Se(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"td",28),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate2"](" ",null==e.depositProduct?null:e.depositProduct.companyBranchProduct.product.name," (",null==e.depositProduct?null:e.depositProduct.companyBranchProduct.product.code,") ")}}function Ee(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"th",27),s["\u0275\u0275text"](1,"Tipo"),s["\u0275\u0275elementEnd"]())}function ye(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"td",29),s["\u0275\u0275pipe"](1,"stockPostTypeColor"),s["\u0275\u0275text"](2),s["\u0275\u0275pipe"](3,"stockPostType"),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275styleProp"]("color",s["\u0275\u0275pipeBind1"](1,3,e.type)),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate1"](" ",s["\u0275\u0275pipeBind1"](3,5,e.type)," ")}}function Ie(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"th",27),s["\u0275\u0275text"](1,"Quantidade"),s["\u0275\u0275elementEnd"]())}function be(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"td",29),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"](" ",e.quantity," ")}}function we(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"th",27),s["\u0275\u0275text"](1,"Observa\xe7\xe3o"),s["\u0275\u0275elementEnd"]())}function xe(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"td",30),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275property"]("matTooltip",e.observation),s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"](" ",e.observation," ")}}function _e(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"th",27),s["\u0275\u0275text"](1,"Data"),s["\u0275\u0275elementEnd"]())}function Ce(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"td",28),s["\u0275\u0275text"](1),s["\u0275\u0275pipe"](2,"momentDate"),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"](" ",s["\u0275\u0275pipeBind2"](2,1,e.dateOfIssue,"DD/MM/YYYY HH:mm")," ")}}function Pe(e,t){1&e&&s["\u0275\u0275element"](0,"th",27)}function ke(e,t){if(1&e){const e=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"td",28),s["\u0275\u0275elementStart"](1,"a",31),s["\u0275\u0275listener"]("click",function(){const t=s["\u0275\u0275restoreView"](e).$implicit;return s["\u0275\u0275nextContext"]().deletePost(t)}),s["\u0275\u0275elementStart"](2,"mat-icon"),s["\u0275\u0275text"](3,"delete"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()}}function Oe(e,t){1&e&&s["\u0275\u0275element"](0,"tr",32)}function De(e,t){1&e&&s["\u0275\u0275element"](0,"tr",33)}function Fe(e,t){if(1&e){const e=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"button",34),s["\u0275\u0275listener"]("click",function(){return s["\u0275\u0275restoreView"](e),s["\u0275\u0275nextContext"]().loadMore()}),s["\u0275\u0275text"](1,"Mais..."),s["\u0275\u0275elementEnd"]()}}function Be(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"tr"),s["\u0275\u0275elementStart"](1,"td"),s["\u0275\u0275text"](2),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](3,"td"),s["\u0275\u0275text"](4),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate2"](" ",e.companyBranchProduct.product.name," (",e.companyBranchProduct.product.code,") "),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate"](e.quantity)}}function Me(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"table",35),s["\u0275\u0275elementStart"](1,"thead"),s["\u0275\u0275elementStart"](2,"tr"),s["\u0275\u0275elementStart"](3,"th"),s["\u0275\u0275text"](4,"Produto"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](5,"th"),s["\u0275\u0275text"](6,"Quantidade"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](7,"tbody"),s["\u0275\u0275template"](8,Be,5,3,"tr",36),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&e){const e=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](8),s["\u0275\u0275property"]("ngForOf",e.depositProducts)}}let je=(()=>{class e{constructor(e,t,n,o,r,a,i){this._toast=e,this._loader=t,this._stockService=n,this._dialog=o,this._alert=r,this._productService=a,this.inputData=i,this.stockPosts=[],this.tableColumns=["product","type","quantity","observation","createdAt","options"],this.productSearchAutocompleteOptions={placeholder:"Produto",onGetItems:e=>this.productSearchAutocompleteOnGetItems(e),onSelectItem:e=>this.productSearchAutocompleteOnSelectItem(e),emitOnClear:!0},this.filter={index:0,limit:40,depositId:i.depositId}}ngOnInit(){this.refresh()}refresh(){this._loader.show(),Promise.all([this.getDeposit(),this.getPosts()]).then(()=>this._loader.dismiss()).catch(()=>this._loader.dismiss())}getDeposit(e={}){return new Promise((t,n)=>{(null==e?void 0:e.showLoader)&&this._loader.show(),this._stockService.getDepositById(this.inputData.depositId).subscribe(n=>{(null==e?void 0:e.showLoader)&&this._loader.dismiss(),this.deposit=n,t()},t=>{(null==e?void 0:e.showLoader)&&this._loader.dismiss(),this._toast.showHttpError(t),n()})})}getPosts(e={}){return new Promise((t,n)=>{(null==e?void 0:e.showLoader)&&this._loader.show(),this._stockService.getPosts(this.filter).subscribe(n=>{(null==e?void 0:e.showLoader)&&this._loader.dismiss(),this.stockPosts=(null==e?void 0:e.concat)?this.stockPosts.concat(n):n,t()},t=>{(null==e?void 0:e.showLoader)&&this._loader.dismiss(),this._toast.showHttpError(t),n()})})}openPostForm(){this._dialog.open(pe,{width:"50%",height:"80%",data:{companyBranchId:this.inputData.companyBranchId,depositId:this.deposit.id}}).afterClosed().subscribe(e=>{e&&e.hasUpdate&&this.refresh()})}productSearchAutocompleteOnGetItems(e){return this._productService.getAllForSales({index:0,limit:8,q:e},this.inputData.companyBranchId).pipe((0,$.U)(e=>e.map(e=>({label:`${e.product.code} - ${e.product.name}`,value:e}))))}productSearchAutocompleteOnSelectItem(e){var t;this.selectedProduct=e.value,this.filter.companyBranchProductId=null===(t=this.selectedProduct)||void 0===t?void 0:t.id,this.filterProduct()}loadMore(){this.filter.index++,this.getPosts({concat:!0})}filterProduct(){this.filter.index=0,this.getPosts({showLoader:!0})}deletePost(e){this._alert.open({message:`Excluir lan\xe7amento #${e.id}? \ud83d\ude15`,title:`#${e.id}`,buttons:[{text:"Cancelar",closeOnClick:!0},{text:"Excluir",color:"warn",onClick:()=>{this._loader.show(),this._stockService.deletePost(e.id).subscribe(e=>{this._loader.dismiss(),this._toast.open("Exclu\xeddo com sucesso","success"),this.refresh()},e=>{this._loader.dismiss(),this._toast.showHttpError(e)})}}]})}clearDeposit(){this._alert.open({message:"Voc\xea tem certeza que deseja limpar este dep\xf3sito?",title:"Limpar dep\xf3sito",buttons:[{text:"Cancelar",closeOnClick:!0},{text:"Limpar",color:"warn",onClick:()=>{this._loader.show(),this._stockService.clearDeposit(this.deposit.id).subscribe(e=>{this._loader.dismiss(),this._toast.open("Dep\xf3sito limpo","success"),this.refresh()},e=>{this._loader.dismiss(),this._toast.showHttpError(e)})}}]})}get depositProducts(){return this.deposit.products.filter(e=>0!=e.quantity)}}return e.\u0275fac=function(t){return new(t||e)(s["\u0275\u0275directiveInject"](c.k),s["\u0275\u0275directiveInject"](l.D),s["\u0275\u0275directiveInject"](H.q),s["\u0275\u0275directiveInject"](i.uw),s["\u0275\u0275directiveInject"](ue.O),s["\u0275\u0275directiveInject"](V.M),s["\u0275\u0275directiveInject"](i.WI))},e.\u0275cmp=s["\u0275\u0275defineComponent"]({type:e,selectors:[["app-stock-posts"]],decls:41,vars:7,consts:[[2,"font-size","24px","margin","16px"],[1,"row"],[1,"col-md-8"],[2,"display","flex","gap","48px","align-items","center"],[2,"font-size","18px"],["mat-flat-button","","color","primary",2,"width","40%",3,"click"],[2,"width","100%",3,"options"],["productAutocomplete",""],["mat-table","",2,"width","100%",3,"dataSource"],["matColumnDef","product"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","type"],["mat-cell","","style","font-weight: bold;",3,"color",4,"matCellDef"],["matColumnDef","quantity"],["mat-cell","","style","font-weight: bold;",4,"matCellDef"],["matColumnDef","observation"],["mat-cell","",3,"matTooltip",4,"matCellDef"],["matColumnDef","createdAt"],["matColumnDef","options"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[2,"text-align","center","padding","10px"],["mat-flat-button","","color","primary",3,"click",4,"ngIf"],[1,"col-md-4"],["class","stock-table",4,"ngIf"],["mat-stroked-button","","color","warn",2,"margin-top","8px",3,"click"],["mat-header-cell",""],["mat-cell",""],["mat-cell","",2,"font-weight","bold"],["mat-cell","",3,"matTooltip"],["href","javascript:;",3,"click"],["mat-header-row",""],["mat-row",""],["mat-flat-button","","color","primary",3,"click"],[1,"stock-table"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&(s["\u0275\u0275element"](0,"button-dialog-close"),s["\u0275\u0275elementStart"](1,"h1",0),s["\u0275\u0275text"](2),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](3,"div",1),s["\u0275\u0275elementStart"](4,"div",2),s["\u0275\u0275elementStart"](5,"div",3),s["\u0275\u0275elementStart"](6,"h2",4),s["\u0275\u0275text"](7,"Lan\xe7amentos"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](8,"button",5),s["\u0275\u0275listener"]("click",function(){return t.openPostForm()}),s["\u0275\u0275text"](9,"Novo lan\xe7amento"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](10,"app-autocomplete",6,7),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](12,"table",8),s["\u0275\u0275elementContainerStart"](13,9),s["\u0275\u0275template"](14,ge,2,0,"th",10),s["\u0275\u0275template"](15,Se,2,2,"td",11),s["\u0275\u0275elementContainerEnd"](),s["\u0275\u0275elementContainerStart"](16,12),s["\u0275\u0275template"](17,Ee,2,0,"th",10),s["\u0275\u0275template"](18,ye,4,7,"td",13),s["\u0275\u0275elementContainerEnd"](),s["\u0275\u0275elementContainerStart"](19,14),s["\u0275\u0275template"](20,Ie,2,0,"th",10),s["\u0275\u0275template"](21,be,2,1,"td",15),s["\u0275\u0275elementContainerEnd"](),s["\u0275\u0275elementContainerStart"](22,16),s["\u0275\u0275template"](23,we,2,0,"th",10),s["\u0275\u0275template"](24,xe,2,2,"td",17),s["\u0275\u0275elementContainerEnd"](),s["\u0275\u0275elementContainerStart"](25,18),s["\u0275\u0275template"](26,_e,2,0,"th",10),s["\u0275\u0275template"](27,Ce,3,4,"td",11),s["\u0275\u0275elementContainerEnd"](),s["\u0275\u0275elementContainerStart"](28,19),s["\u0275\u0275template"](29,Pe,1,0,"th",10),s["\u0275\u0275template"](30,ke,4,0,"td",11),s["\u0275\u0275elementContainerEnd"](),s["\u0275\u0275template"](31,Oe,1,0,"tr",20),s["\u0275\u0275template"](32,De,1,0,"tr",21),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](33,"div",22),s["\u0275\u0275template"](34,Fe,2,0,"button",23),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](35,"div",24),s["\u0275\u0275elementStart"](36,"h2",4),s["\u0275\u0275text"](37,"Total"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275template"](38,Me,9,1,"table",25),s["\u0275\u0275elementStart"](39,"button",26),s["\u0275\u0275listener"]("click",function(){return t.clearDeposit()}),s["\u0275\u0275text"](40,"Limpar dep\xf3sito"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&e&&(s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate"](null==t.deposit?null:t.deposit.name),s["\u0275\u0275advance"](8),s["\u0275\u0275property"]("options",t.productSearchAutocompleteOptions),s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("dataSource",t.stockPosts),s["\u0275\u0275advance"](19),s["\u0275\u0275property"]("matHeaderRowDef",t.tableColumns),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("matRowDefColumns",t.tableColumns),s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("ngIf",t.stockPosts.length>=t.filter.limit),s["\u0275\u0275advance"](4),s["\u0275\u0275property"]("ngIf",null==t.deposit?null:t.deposit.products.length))},directives:[v.P,f.lW,R.Y,C.BZ,C.w1,C.fO,C.Dz,C.as,C.nj,o.O5,C.ge,C.ev,he.gM,P.Hw,C.XQ,C.Gk,o.sg],pipes:[fe,re,ve.v],styles:[".stock-table[_ngcontent-%COMP%]{width:100%}.stock-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid #ddd}.stock-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .stock-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{max-width:calc(100vw / 10);white-space:nowrap;word-wrap:break-word;overflow:hidden;text-overflow:ellipsis}.stock-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:0 7px}"]}),e})();var Ae=n(93738);function Te(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"mat-option",13),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275property"]("value",e.id),s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate2"](" ",e.tradeName," - ",e.name," ")}}function Ne(e,t){if(1&e){const e=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"button",14),s["\u0275\u0275listener"]("click",function(){return s["\u0275\u0275restoreView"](e),s["\u0275\u0275nextContext"]().openDepositTransfer()}),s["\u0275\u0275text"](1," Transfer\xeancia de estoque "),s["\u0275\u0275elementStart"](2,"mat-icon"),s["\u0275\u0275text"](3,"swap_horiz"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()}}function qe(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"tr"),s["\u0275\u0275elementStart"](1,"td"),s["\u0275\u0275text"](2),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](3,"td"),s["\u0275\u0275text"](4),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate2"](" ",e.companyBranchProduct.product.name," (",e.companyBranchProduct.product.code,") "),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate"](e.quantity)}}function $e(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"table",18),s["\u0275\u0275elementStart"](1,"thead"),s["\u0275\u0275elementStart"](2,"tr"),s["\u0275\u0275elementStart"](3,"th"),s["\u0275\u0275text"](4,"Produto"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](5,"th"),s["\u0275\u0275text"](6,"Quantidade"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](7,"tbody"),s["\u0275\u0275template"](8,qe,5,3,"tr",19),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&e){const e=s["\u0275\u0275nextContext"]().$implicit;s["\u0275\u0275advance"](8),s["\u0275\u0275property"]("ngForOf",e.products)}}function Le(e,t){if(1&e){const e=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"div",15),s["\u0275\u0275elementStart"](1,"mat-card"),s["\u0275\u0275elementStart"](2,"mat-card-header"),s["\u0275\u0275elementStart"](3,"mat-card-title",16),s["\u0275\u0275text"](4),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](5,"mat-card-content"),s["\u0275\u0275template"](6,$e,9,1,"table",17),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](7,"mat-card-actions"),s["\u0275\u0275elementStart"](8,"button",14),s["\u0275\u0275listener"]("click",function(){const t=s["\u0275\u0275restoreView"](e).$implicit;return s["\u0275\u0275nextContext"]().openStockPosts(t.id)}),s["\u0275\u0275text"](9,"Lan\xe7amentos"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit;s["\u0275\u0275advance"](4),s["\u0275\u0275textInterpolate"](e.name),s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("ngIf",e.products.length)}}function He(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"tr"),s["\u0275\u0275elementStart"](1,"td"),s["\u0275\u0275text"](2),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](3,"td"),s["\u0275\u0275text"](4),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate2"](" ",e.product.product.name," (",e.product.product.code,") "),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate"](e.quantity)}}function Ve(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"div",20),s["\u0275\u0275elementStart"](1,"h5"),s["\u0275\u0275text"](2,"Total"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](3,"table",18),s["\u0275\u0275elementStart"](4,"thead"),s["\u0275\u0275elementStart"](5,"tr"),s["\u0275\u0275elementStart"](6,"th"),s["\u0275\u0275text"](7,"Produto"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](8,"th"),s["\u0275\u0275text"](9,"Quantidade"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](10,"tbody"),s["\u0275\u0275template"](11,He,5,3,"tr",19),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&e){const e=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](11),s["\u0275\u0275property"]("ngForOf",e.productsTotals)}}let Re=(()=>{class e{constructor(e,t,n,o,r,a){this._title=e,this._toast=t,this._loader=n,this._stockService=o,this._companyBranchService=r,this._dialog=a,this.companyBranches=[],this.deposits=[],this.productsTotals=[]}ngOnInit(){this._title.set("Controle de estoque"),this.getCompanyBranches()}getStockDeposits(e={}){(null==e?void 0:e.showLoader)&&this._loader.show(),this._stockService.getDeposits(Number(this.companyBranchIdValue)).subscribe(t=>{(null==e?void 0:e.showLoader)&&this._loader.dismiss(),this.deposits=t,this.calculeProductsTotals()},t=>{(null==e?void 0:e.showLoader)&&this._loader.dismiss(),this._toast.showHttpError(t)})}getCompanyBranches(){this._companyBranchService.getAll().subscribe(e=>{this.companyBranches=e},e=>{this._toast.showHttpError(e)})}openStockPosts(e){const t={depositId:e,companyBranchId:Number(this.companyBranchIdValue)};this._dialog.open(je,{maxWidth:"90%",width:"90%",height:"90%",data:t}).afterClosed().subscribe(e=>{this.getStockDeposits()})}openDepositTransfer(){const e={companyBranchId:Number(this.companyBranchIdValue)};this._dialog.open(ee,{width:"50%",height:"80%",data:e}).afterClosed().subscribe(e=>{this.getStockDeposits()})}calculeProductsTotals(){this.productsTotals=[],this.deposits.forEach(e=>{e.products.forEach(e=>{const t=this.productsTotals.find(t=>t.product.id==e.companyBranchProduct.id);!t&&e.quantity>0?this.productsTotals.push({product:e.companyBranchProduct,quantity:e.quantity}):e.quantity>0&&(t.quantity+=e.quantity)})})}}return e.\u0275fac=function(t){return new(t||e)(s["\u0275\u0275directiveInject"](_.y),s["\u0275\u0275directiveInject"](c.k),s["\u0275\u0275directiveInject"](l.D),s["\u0275\u0275directiveInject"](H.q),s["\u0275\u0275directiveInject"](m._),s["\u0275\u0275directiveInject"](i.uw))},e.\u0275cmp=s["\u0275\u0275defineComponent"]({type:e,selectors:[["app-stock-control"]],decls:19,vars:6,consts:[[2,"font-size","32px","margin","16px"],[1,"row"],[1,"col-md-12"],[2,"display","flex","gap","48px","align-items","center"],[2,"width","50%"],[3,"ngModel","ngModelChange","selectionChange"],["companyBranch",""],[3,"value",4,"ngFor","ngForOf"],["mat-flat-button","","color","primary",3,"disabled","click"],["mat-stroked-button","","color","primary",3,"click",4,"ngIf"],[1,"col-md-9"],["class","col-md-4","style","margin-bottom: 24px;",4,"ngFor","ngForOf"],["class","col-3",4,"ngIf"],[3,"value"],["mat-stroked-button","","color","primary",3,"click"],[1,"col-md-4",2,"margin-bottom","24px"],[2,"font-weight","bold"],["class","stock-table",4,"ngIf"],[1,"stock-table"],[4,"ngFor","ngForOf"],[1,"col-3"]],template:function(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"h1",0),s["\u0275\u0275text"](1,"Controle de estoque"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](2,"div",1),s["\u0275\u0275elementStart"](3,"div",2),s["\u0275\u0275elementStart"](4,"div",3),s["\u0275\u0275elementStart"](5,"mat-form-field",4),s["\u0275\u0275elementStart"](6,"mat-label"),s["\u0275\u0275text"](7,"Unidade"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](8,"mat-select",5,6),s["\u0275\u0275listener"]("ngModelChange",function(e){return t.companyBranchIdValue=e})("selectionChange",function(){return t.getStockDeposits({showLoader:!0})}),s["\u0275\u0275template"](10,Te,2,3,"mat-option",7),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](11,"button",8),s["\u0275\u0275listener"]("click",function(){return t.getStockDeposits({showLoader:!0})}),s["\u0275\u0275text"](12,"Atualizar"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275template"](13,Ne,4,0,"button",9),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](14,"div",1),s["\u0275\u0275elementStart"](15,"div",10),s["\u0275\u0275elementStart"](16,"div",1),s["\u0275\u0275template"](17,Le,10,2,"div",11),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275template"](18,Ve,12,1,"div",12),s["\u0275\u0275elementEnd"]()),2&e){const e=s["\u0275\u0275reference"](9);s["\u0275\u0275advance"](8),s["\u0275\u0275property"]("ngModel",t.companyBranchIdValue),s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("ngForOf",t.companyBranches),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("disabled",!e.value),s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("ngIf",e.value),s["\u0275\u0275advance"](4),s["\u0275\u0275property"]("ngForOf",t.deposits),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf",t.deposits.length)}},directives:[p.KE,p.hX,h.gD,a.JJ,a.On,o.sg,f.lW,o.O5,g.ey,P.Hw,Ae.a8,Ae.dk,Ae.n5,Ae.dn,Ae.hq],styles:[".stock-table[_ngcontent-%COMP%]{width:100%}.stock-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid #ddd}.stock-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .stock-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:6px}"]}),e})();const Ge=[{path:"",component:(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=s["\u0275\u0275defineComponent"]({type:e,selectors:[["app-stock"]],decls:1,vars:0,template:function(e,t){1&e&&s["\u0275\u0275element"](0,"router-outlet")},directives:[r.lC],styles:[""]}),e})(),children:[{path:"deposits",component:q},{path:"stock-control",component:Re}]}];let Ye=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=s["\u0275\u0275defineInjector"]({imports:[[r.Bz.forChild(Ge)],r.Bz]}),e})();var ze=n(6591),Ue=n(44466),Je=n(35503);let We=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=s["\u0275\u0275defineInjector"]({imports:[[o.ez,ze.h,Ye,Ue.m,a.UX,a.u5,Je.D]]}),e})()},35503:function(e,t,n){"use strict";n.d(t,{D:function(){return r}});var o=n(37716);let r=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=o["\u0275\u0275defineInjector"]({}),e})()},44466:function(e,t,n){"use strict";n.d(t,{m:function(){return d}});var o=n(6591),r=n(35503),a=n(38583),i=n(69129),s=n(3679),l=n(44836),c=n(37716);let d=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=c["\u0275\u0275defineInjector"]({imports:[[o.h,r.D,a.ez,i.yI,s.UX,s.u5,l.GooglePlaceModule],i.yI]}),e})()}}]);