(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"7itd":function(t,e,n){!function(t,e,n){"use strict";var o=function(){return function(t){t&&Object.assign(this,t)}}(),r=function(){function e(t,e){this.el=t,this.ngZone=e,this.onAddressChange=new n.EventEmitter}return e.prototype.ngAfterViewInit=function(){this.options||(this.options=new o),this.initialize()},e.prototype.isGoogleLibExists=function(){return!(!google||!google.maps||!google.maps.places)},e.prototype.initialize=function(){var t=this;if(!this.isGoogleLibExists())throw new Error("Google maps library can not be found");if(this.autocomplete=new google.maps.places.Autocomplete(this.el.nativeElement,this.options),!this.autocomplete)throw new Error("Autocomplete is not initialized");null!=!this.autocomplete.addListener&&(this.eventListener=this.autocomplete.addListener("place_changed",function(){t.handleChangeEvent()})),this.el.nativeElement.addEventListener("keydown",function(e){e.key&&"enter"==e.key.toLowerCase()&&e.target===t.el.nativeElement&&(e.preventDefault(),e.stopPropagation())}),window&&window.navigator&&window.navigator.userAgent&&navigator.userAgent.match(/(iPad|iPhone|iPod)/g)&&setTimeout(function(){var t=document.getElementsByClassName("pac-container");if(t){var e=Array.from(t);if(e)for(var n=0,o=e;n<o.length;n++){var r=o[n];r&&r.addEventListener("touchend",function(t){t.stopImmediatePropagation()})}}},500)},e.prototype.reset=function(){this.autocomplete.setComponentRestrictions(this.options.componentRestrictions),this.autocomplete.setTypes(this.options.types)},e.prototype.handleChangeEvent=function(){var t=this;this.ngZone.run(function(){t.place=t.autocomplete.getPlace(),t.place&&t.onAddressChange.emit(t.place)})},e.ctorParameters=function(){return[{type:n.ElementRef},{type:n.NgZone}]},e.propDecorators={options:[{type:n.Input,args:["options"]}],onAddressChange:[{type:n.Output}]},e.\u0275fac=function(n){return new(n||e)(t.\u0275\u0275directiveInject(t.ElementRef),t.\u0275\u0275directiveInject(t.NgZone))},e.\u0275dir=t.\u0275\u0275defineDirective({type:e,selectors:[["","ngx-google-places-autocomplete",""]],inputs:{options:"options"},outputs:{onAddressChange:"onAddressChange"},exportAs:["ngx-places"]}),e}();e.GooglePlaceModule=function(){function e(){}return e.ctorParameters=function(){return[]},e.\u0275mod=t.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=t.\u0275\u0275defineInjector({factory:function(t){return new(t||e)}}),e}(),e.GooglePlaceDirective=r,Object.defineProperty(e,"__esModule",{value:!0})}(n("fXoL"),e,n("fXoL"))},PCNd:function(t,e,n){"use strict";n.d(e,"a",function(){return d});var o=n("ssao"),r=n("iTUp"),a=n("ofXK"),i=n("tmjD"),l=n("3Pt+"),s=n("7itd"),c=n("fXoL");let d=(()=>{class t{}return t.\u0275mod=c["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=c["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[o.a,r.a,a.c,i.b,l.r,l.i,s.GooglePlaceModule],i.b]}),t})()},iTUp:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var o=n("fXoL");let r=(()=>{class t{}return t.\u0275mod=o["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=o["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)}}),t})()},sfnj:function(t,e,n){"use strict";n.r(e),n.d(e,"StockModule",function(){return Vt});var o=n("ofXK"),r=n("tyNb"),a=n("3Pt+"),i=n("0IaG"),l=n("fXoL"),s=n("5dVO"),c=n("2g2N"),d=n("xqXW"),m=n("q3OW"),p=n("kmnG"),u=n("qFsG"),h=n("d3UM"),f=n("bTqV"),v=n("IpZF"),g=n("FKr1");function S(t,e){1&t&&l["\u0275\u0275element"](0,"button-dialog-close")}function y(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"h3",12),l["\u0275\u0275text"](1,"Novo dep\xf3sito"),l["\u0275\u0275elementEnd"]())}function E(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"h3",12),l["\u0275\u0275text"](1),l["\u0275\u0275elementEnd"]()),2&t){const t=l["\u0275\u0275nextContext"]();l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate1"]("Edi\xe7\xe3o ",t.deposit.name,"")}}function b(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"mat-error"),l["\u0275\u0275text"](1," Este campo \xe9 obrigat\xf3rio "),l["\u0275\u0275elementEnd"]())}function I(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"mat-option",13),l["\u0275\u0275text"](1),l["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;l["\u0275\u0275property"]("value",t.id),l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate1"](" ",t.name," ")}}function x(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"mat-error"),l["\u0275\u0275text"](1," Este campo \xe9 obrigat\xf3rio "),l["\u0275\u0275elementEnd"]())}let w=(()=>{class t{constructor(t,e,n,o,r,a){this._loader=t,this._toast=e,this._depositService=n,this._companyBranchService=o,this._dialogRef=r,this.inputData=a,this.companyBranches=[],this.initForm()}ngOnInit(){this.getCompanyBranches(),this.inputData.depositId&&this.getDeposit().then(()=>this.setFormValues())}initForm(){this.depositForm=new a.g({name:new a.e(null,a.s.required),companyBranch:new a.e(null,a.s.required)})}setFormValues(){this.depositForm.get("name").setValue(this.deposit.name),this.depositForm.get("companyBranch").setValue(this.deposit.companyBranch.id)}getDeposit(){return new Promise((t,e)=>{this._loader.show(),this._depositService.getById(this.inputData.depositId).subscribe(e=>{this._loader.dismiss(),this.deposit=e,t(e)},t=>{this._loader.dismiss(),this._toast.showHttpError(t),e(t)})})}getCompanyBranches(){this._companyBranchService.getAll().subscribe(t=>{this.companyBranches=t},t=>{this._toast.showHttpError(t)})}save(){if(!this.depositForm.valid)throw this.depositForm.markAllAsTouched(),this._toast.open("Preencha todos os campos obrigat\xf3rios"),new Error("Invalid form");const t={name:this.depositForm.get("name").value,companyBranchId:this.depositForm.get("companyBranch").value};let e;this.deposit?(t.id=this.deposit.id,e=this._depositService.update(t)):e=this._depositService.create(t),this._loader.show(),e.subscribe(t=>{this._loader.dismiss(),this._toast.open("Salvo com sucesso!","success"),this.deposit=t,this.initForm(),this.setFormValues(),this._dialogRef.close({hasUpdate:!0})},t=>{this._loader.dismiss(),this._toast.showHttpError(t)})}get isModal(){return!!this.inputData}}return t.\u0275fac=function(e){return new(e||t)(l["\u0275\u0275directiveInject"](s.a),l["\u0275\u0275directiveInject"](c.a),l["\u0275\u0275directiveInject"](d.a),l["\u0275\u0275directiveInject"](m.a),l["\u0275\u0275directiveInject"](i.g),l["\u0275\u0275directiveInject"](i.a))},t.\u0275cmp=l["\u0275\u0275defineComponent"]({type:t,selectors:[["app-deposit-form"]],decls:25,vars:7,consts:[[4,"ngIf"],[1,"row"],[1,"col-sm-12"],["class","title",4,"ngIf"],[3,"formGroup"],[1,"col-12"],["matInput","","placeholder","Nome","autocomplete","off","formControlName","name"],["name",""],["formControlName","companyBranch"],["type",""],[3,"value",4,"ngFor","ngForOf"],["mat-flat-button","","color","primary",2,"margin","24px 0",3,"click"],[1,"title"],[3,"value"]],template:function(t,e){if(1&t&&(l["\u0275\u0275template"](0,S,1,0,"button-dialog-close",0),l["\u0275\u0275elementStart"](1,"div",1),l["\u0275\u0275elementStart"](2,"div",2),l["\u0275\u0275template"](3,y,2,0,"h3",3),l["\u0275\u0275template"](4,E,2,1,"h3",3),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](5,"form",4),l["\u0275\u0275elementStart"](6,"div",1),l["\u0275\u0275elementStart"](7,"div",5),l["\u0275\u0275elementStart"](8,"mat-form-field"),l["\u0275\u0275element"](9,"input",6,7),l["\u0275\u0275template"](11,b,2,0,"mat-error",0),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](12,"div",5),l["\u0275\u0275elementStart"](13,"mat-form-field"),l["\u0275\u0275elementStart"](14,"mat-label"),l["\u0275\u0275text"](15,"Unidade"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](16,"mat-select",8,9),l["\u0275\u0275template"](18,I,2,2,"mat-option",10),l["\u0275\u0275elementEnd"](),l["\u0275\u0275template"](19,x,2,0,"mat-error",0),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275element"](20,"hr"),l["\u0275\u0275elementStart"](21,"div",1),l["\u0275\u0275elementStart"](22,"div",2),l["\u0275\u0275elementStart"](23,"button",11),l["\u0275\u0275listener"]("click",function(){return e.save()}),l["\u0275\u0275text"](24,"Salvar"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()),2&t){const t=l["\u0275\u0275reference"](10);l["\u0275\u0275property"]("ngIf",e.isModal),l["\u0275\u0275advance"](3),l["\u0275\u0275property"]("ngIf",!e.deposit),l["\u0275\u0275advance"](1),l["\u0275\u0275property"]("ngIf",e.deposit),l["\u0275\u0275advance"](1),l["\u0275\u0275property"]("formGroup",e.depositForm),l["\u0275\u0275advance"](6),l["\u0275\u0275property"]("ngIf",!t.valid),l["\u0275\u0275advance"](7),l["\u0275\u0275property"]("ngForOf",e.companyBranches),l["\u0275\u0275advance"](1),l["\u0275\u0275property"]("ngIf",!e.depositForm.get("companyBranch").valid)}},directives:[o.m,a.t,a.n,a.h,p.c,u.b,a.d,a.m,a.f,p.f,h.a,o.l,f.a,v.a,p.b,g.k],styles:[""]}),t})();var C=n("K6Ak"),_=n("+0xr"),P=n("NFeN");function O(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"th",11),l["\u0275\u0275text"](1,"#"),l["\u0275\u0275elementEnd"]())}function k(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"td",12),l["\u0275\u0275text"](1),l["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate"](t.id)}}function D(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"th",11),l["\u0275\u0275text"](1,"Nome"),l["\u0275\u0275elementEnd"]())}function F(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"td",12),l["\u0275\u0275text"](1),l["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate1"](" ",t.name," ")}}function M(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"th",11),l["\u0275\u0275text"](1,"Unidade"),l["\u0275\u0275elementEnd"]())}function B(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"td",12),l["\u0275\u0275text"](1),l["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate1"](" ",t.companyBranch.name," ")}}function j(t,e){1&t&&l["\u0275\u0275element"](0,"th",11)}function q(t,e){if(1&t){const t=l["\u0275\u0275getCurrentView"]();l["\u0275\u0275elementStart"](0,"td",12),l["\u0275\u0275elementStart"](1,"a",13),l["\u0275\u0275listener"]("click",function(){l["\u0275\u0275restoreView"](t);const n=e.$implicit;return l["\u0275\u0275nextContext"]().openForm(n.id)}),l["\u0275\u0275elementStart"](2,"mat-icon"),l["\u0275\u0275text"](3,"edit"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()}}function A(t,e){1&t&&l["\u0275\u0275element"](0,"tr",14)}function T(t,e){1&t&&l["\u0275\u0275element"](0,"tr",15)}let N=(()=>{class t{constructor(t,e,n,o,r){this._loader=t,this._toast=e,this._depositService=n,this._dialog=o,this._title=r,this.deposits=[],this.tableColumns=["id","name","companyBranch","options"]}ngOnInit(){this._title.set("Dep\xf3sitos"),this.getDeposits()}getDeposits(){return new Promise((t,e)=>{this._loader.show(),this._depositService.getAll().subscribe(e=>{this._loader.dismiss(),this.deposits=e,t()},t=>{this._loader.dismiss(),this._toast.showHttpError(t),e()})})}openForm(t){this._dialog.open(w,{width:"90%",height:"90%",data:{depositId:t}}).afterClosed().subscribe(t=>{t&&t.hasUpdate&&this.getDeposits()})}}return t.\u0275fac=function(e){return new(e||t)(l["\u0275\u0275directiveInject"](s.a),l["\u0275\u0275directiveInject"](c.a),l["\u0275\u0275directiveInject"](d.a),l["\u0275\u0275directiveInject"](i.b),l["\u0275\u0275directiveInject"](C.a))},t.\u0275cmp=l["\u0275\u0275defineComponent"]({type:t,selectors:[["app-deposits"]],decls:20,vars:3,consts:[[2,"font-size","32px","margin","16px"],["mat-table","",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","companyBranch"],["matColumnDef","options"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["href","javascript:;","mat-fab","","color","primary",1,"btn-add",3,"click"],["mat-header-cell",""],["mat-cell",""],["href","javascript:;",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"h1",0),l["\u0275\u0275text"](1,"Dep\xf3sitos"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](2,"table",1),l["\u0275\u0275elementContainerStart"](3,2),l["\u0275\u0275template"](4,O,2,0,"th",3),l["\u0275\u0275template"](5,k,2,1,"td",4),l["\u0275\u0275elementContainerEnd"](),l["\u0275\u0275elementContainerStart"](6,5),l["\u0275\u0275template"](7,D,2,0,"th",3),l["\u0275\u0275template"](8,F,2,1,"td",4),l["\u0275\u0275elementContainerEnd"](),l["\u0275\u0275elementContainerStart"](9,6),l["\u0275\u0275template"](10,M,2,0,"th",3),l["\u0275\u0275template"](11,B,2,1,"td",4),l["\u0275\u0275elementContainerEnd"](),l["\u0275\u0275elementContainerStart"](12,7),l["\u0275\u0275template"](13,j,1,0,"th",3),l["\u0275\u0275template"](14,q,4,0,"td",4),l["\u0275\u0275elementContainerEnd"](),l["\u0275\u0275template"](15,A,1,0,"tr",8),l["\u0275\u0275template"](16,T,1,0,"tr",9),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](17,"button",10),l["\u0275\u0275listener"]("click",function(){return e.openForm()}),l["\u0275\u0275elementStart"](18,"mat-icon"),l["\u0275\u0275text"](19,"add"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()),2&t&&(l["\u0275\u0275advance"](2),l["\u0275\u0275property"]("dataSource",e.deposits),l["\u0275\u0275advance"](13),l["\u0275\u0275property"]("matHeaderRowDef",e.tableColumns),l["\u0275\u0275advance"](1),l["\u0275\u0275property"]("matRowDefColumns",e.tableColumns))},directives:[_.j,_.c,_.e,_.b,_.g,_.i,f.a,P.a,_.d,_.a,_.f,_.h],styles:["table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:-webkit-sticky;position:sticky;top:64px;background:#eee;z-index:10}.btn-add[_ngcontent-%COMP%]{position:fixed;bottom:26px;right:30px}"]}),t})();var $=n("lJxs"),R=n("wd/R"),L=n("8hSh"),H=n("Gdn9"),G=n("Id7a"),V=n("bSwM");function U(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"mat-option",22),l["\u0275\u0275text"](1),l["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;l["\u0275\u0275property"]("value",t.id),l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate1"](" ",t.name," ")}}function Y(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"mat-error"),l["\u0275\u0275text"](1," Este campo \xe9 obrigat\xf3rio "),l["\u0275\u0275elementEnd"]())}function z(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"mat-option",22),l["\u0275\u0275text"](1),l["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;l["\u0275\u0275property"]("value",t.id),l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate1"](" ",t.name," ")}}function X(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"mat-error"),l["\u0275\u0275text"](1," Este campo \xe9 obrigat\xf3rio "),l["\u0275\u0275elementEnd"]())}function Q(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"mat-error"),l["\u0275\u0275text"](1," Este campo \xe9 obrigat\xf3rio "),l["\u0275\u0275elementEnd"]())}function Z(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"mat-error"),l["\u0275\u0275text"](1," Este campo \xe9 obrigat\xf3rio "),l["\u0275\u0275elementEnd"]())}const J=function(){return{standalone:!0}};function K(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"mat-checkbox",24),l["\u0275\u0275listener"]("ngModelChange",function(t){return e.$implicit.selected=t}),l["\u0275\u0275text"](1),l["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;l["\u0275\u0275property"]("ngModel",t.selected)("ngModelOptions",l["\u0275\u0275pureFunction0"](4,J)),l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate2"](" ",t.product.product.name," (",t.product.product.code,") ")}}function W(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"div",1),l["\u0275\u0275elementStart"](1,"h4"),l["\u0275\u0275text"](2,"Incluir tamb\xe9m:"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](3,"div"),l["\u0275\u0275template"](4,K,2,5,"mat-checkbox",23),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()),2&t){const t=l["\u0275\u0275nextContext"]();l["\u0275\u0275advance"](4),l["\u0275\u0275property"]("ngForOf",t.relatedProducts)}}let tt=(()=>{class t{constructor(t,e,n,o,r,a,i){this._toast=t,this._loader=e,this._stockService=n,this._productService=o,this._depositService=r,this._dialogRef=a,this.inputData=i,this.productSearchAutocompleteOptions={placeholder:"Produto",onGetItems:t=>this.productSearchAutocompleteOnGetItems(t),onSelectItem:t=>this.productSearchAutocompleteOnSelectItem(t),emitOnClear:!0},this.deposits=[],this.relatedProducts=[],this.initForm()}ngOnInit(){this.getDeposits()}initForm(){this.depositTransferForm=new a.g({originDeposit:new a.e(null,a.s.required),destinationDeposit:new a.e(null,a.s.required),companyBranchProduct:new a.e(null,a.s.required),quantity:new a.e(null,[a.s.required,a.s.min(1)]),dateOfIssue:new a.e(R().format("YYYY-MM-DDTHH:mm"),a.s.required),observation:new a.e(null)})}getDeposits(){this._loader.show(),this._depositService.getAll({companyBranchId:this.inputData.companyBranchId}).subscribe(t=>{this._loader.dismiss(),this.deposits=t},t=>{this._loader.dismiss(),this._toast.showHttpError(t)})}productSearchAutocompleteOnGetItems(t){return this._productService.getAllForSales({index:0,limit:8,q:t},this.inputData.companyBranchId).pipe(Object($.a)(t=>t.map(t=>({label:`${t.product.code} - ${t.product.name}`,value:t}))))}productSearchAutocompleteOnSelectItem(t){var e;this.selectedProduct=t.value,this.depositTransferForm.get("companyBranchProduct").setValue((null===(e=t.value)||void 0===e?void 0:e.id)||null),this.selectedProduct?this.getRelatedProducts():this.relatedProducts=[]}getRelatedProducts(){this._productService.getRelated(this.selectedProduct.id).subscribe(t=>{this.relatedProducts=t.map(t=>({product:t.referencedCompanyBranchProduct,selected:t.isDefault}))},t=>{this._toast.showHttpError(t)})}transfer(){if(!this.depositTransferForm.valid)throw this.depositTransferForm.markAllAsTouched(),this._toast.open("Preencha todos os campos obrigat\xf3rios"),new Error("Invalid form");const t=this.depositTransferForm.get("originDeposit").value,e=this.depositTransferForm.get("destinationDeposit").value,n=this.depositTransferForm.get("companyBranchProduct").value,o=this.depositTransferForm.get("quantity").value,r=R(this.depositTransferForm.get("dateOfIssue").value).toISOString(),a=this.depositTransferForm.get("observation").value,i=[{originDepositId:t,destinationDepositId:e,companyBranchProductId:n,quantity:o,dateOfIssue:r,observation:a},...this.relatedProducts.filter(t=>t.selected).map(n=>({originDepositId:t,destinationDepositId:e,companyBranchProductId:n.product.id,quantity:o,dateOfIssue:r,observation:"[Rel.] "+(a||"")}))];this._loader.show(),this._stockService.depositTransfer(i).subscribe(t=>{this._loader.dismiss(),this._toast.open("Transfer\xeancia conclu\xedda","success"),this._dialogRef.close()},t=>{this._loader.dismiss(),this._toast.showHttpError(t),this._dialogRef.close({hasUpdate:!0})})}}return t.\u0275fac=function(e){return new(e||t)(l["\u0275\u0275directiveInject"](c.a),l["\u0275\u0275directiveInject"](s.a),l["\u0275\u0275directiveInject"](L.a),l["\u0275\u0275directiveInject"](H.a),l["\u0275\u0275directiveInject"](d.a),l["\u0275\u0275directiveInject"](i.g),l["\u0275\u0275directiveInject"](i.a))},t.\u0275cmp=l["\u0275\u0275defineComponent"]({type:t,selectors:[["app-deposit-transfer"]],decls:46,vars:9,consts:[[1,"row"],[1,"col-sm-12"],[1,"title"],[3,"formGroup"],[1,"col-md-6"],["formControlName","originDeposit"],["type",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["formControlName","destinationDeposit"],[1,"col-12"],[3,"options"],["productAutocomplete",""],["matInput","","placeholder","Quantidade","type","number","autocomplete","off","formControlName","quantity"],["quantity",""],["matInput","","type","datetime-local","placeholder","Data","autocomplete","off","formControlName","dateOfIssue"],["dateOfIssue",""],[1,"col-md-12"],["matInput","","placeholder","Observa\xe7\xe3o","autocomplete","off","formControlName","observation"],["observation",""],["class","col-sm-12",4,"ngIf"],["mat-flat-button","","color","primary",2,"margin","24px 0",3,"click"],[3,"value"],[3,"ngModel","ngModelOptions","ngModelChange",4,"ngFor","ngForOf"],[3,"ngModel","ngModelOptions","ngModelChange"]],template:function(t,e){if(1&t&&(l["\u0275\u0275element"](0,"button-dialog-close"),l["\u0275\u0275elementStart"](1,"div",0),l["\u0275\u0275elementStart"](2,"div",1),l["\u0275\u0275elementStart"](3,"h3",2),l["\u0275\u0275text"](4,"Transfer\xeancia de estoque"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](5,"form",3),l["\u0275\u0275elementStart"](6,"div",0),l["\u0275\u0275elementStart"](7,"div",4),l["\u0275\u0275elementStart"](8,"mat-form-field"),l["\u0275\u0275elementStart"](9,"mat-label"),l["\u0275\u0275text"](10,"Dep\xf3sito origem"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](11,"mat-select",5,6),l["\u0275\u0275template"](13,U,2,2,"mat-option",7),l["\u0275\u0275elementEnd"](),l["\u0275\u0275template"](14,Y,2,0,"mat-error",8),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](15,"div",4),l["\u0275\u0275elementStart"](16,"mat-form-field"),l["\u0275\u0275elementStart"](17,"mat-label"),l["\u0275\u0275text"](18,"Dep\xf3sito destino"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](19,"mat-select",9,6),l["\u0275\u0275template"](21,z,2,2,"mat-option",7),l["\u0275\u0275elementEnd"](),l["\u0275\u0275template"](22,X,2,0,"mat-error",8),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](23,"div",10),l["\u0275\u0275element"](24,"app-autocomplete",11,12),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](26,"div",4),l["\u0275\u0275elementStart"](27,"mat-form-field"),l["\u0275\u0275element"](28,"input",13,14),l["\u0275\u0275template"](30,Q,2,0,"mat-error",8),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](31,"div",4),l["\u0275\u0275elementStart"](32,"mat-form-field"),l["\u0275\u0275element"](33,"input",15,16),l["\u0275\u0275template"](35,Z,2,0,"mat-error",8),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](36,"div",17),l["\u0275\u0275elementStart"](37,"mat-form-field"),l["\u0275\u0275element"](38,"input",18,19),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275element"](40,"hr"),l["\u0275\u0275elementStart"](41,"div",0),l["\u0275\u0275template"](42,W,5,1,"div",20),l["\u0275\u0275elementStart"](43,"div",1),l["\u0275\u0275elementStart"](44,"button",21),l["\u0275\u0275listener"]("click",function(){return e.transfer()}),l["\u0275\u0275text"](45,"Transferir"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()),2&t){const t=l["\u0275\u0275reference"](29),n=l["\u0275\u0275reference"](34);l["\u0275\u0275advance"](5),l["\u0275\u0275property"]("formGroup",e.depositTransferForm),l["\u0275\u0275advance"](8),l["\u0275\u0275property"]("ngForOf",e.deposits),l["\u0275\u0275advance"](1),l["\u0275\u0275property"]("ngIf",!e.depositTransferForm.get("originDeposit").valid),l["\u0275\u0275advance"](7),l["\u0275\u0275property"]("ngForOf",e.deposits),l["\u0275\u0275advance"](1),l["\u0275\u0275property"]("ngIf",!e.depositTransferForm.get("destinationDeposit").valid),l["\u0275\u0275advance"](2),l["\u0275\u0275property"]("options",e.productSearchAutocompleteOptions),l["\u0275\u0275advance"](6),l["\u0275\u0275property"]("ngIf",!t.valid),l["\u0275\u0275advance"](5),l["\u0275\u0275property"]("ngIf",!n.valid),l["\u0275\u0275advance"](7),l["\u0275\u0275property"]("ngIf",null==e.relatedProducts?null:e.relatedProducts.length)}},directives:[v.a,a.t,a.n,a.h,p.c,p.f,h.a,a.m,a.f,o.l,o.m,G.a,u.b,a.q,a.d,f.a,g.k,p.b,V.a,a.p],styles:[""]}),t})();function et(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"mat-option",21),l["\u0275\u0275text"](1),l["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;l["\u0275\u0275property"]("value",t.id),l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate1"](" ",t.label," ")}}function nt(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"mat-error"),l["\u0275\u0275text"](1," Este campo \xe9 obrigat\xf3rio "),l["\u0275\u0275elementEnd"]())}function ot(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"mat-error"),l["\u0275\u0275text"](1," Este campo \xe9 obrigat\xf3rio "),l["\u0275\u0275elementEnd"]())}function rt(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"mat-error"),l["\u0275\u0275text"](1," Este campo \xe9 obrigat\xf3rio "),l["\u0275\u0275elementEnd"]())}const at=function(){return{standalone:!0}};function it(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"mat-checkbox",23),l["\u0275\u0275listener"]("ngModelChange",function(t){return e.$implicit.selected=t}),l["\u0275\u0275text"](1),l["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;l["\u0275\u0275property"]("ngModel",t.selected)("ngModelOptions",l["\u0275\u0275pureFunction0"](4,at)),l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate2"](" ",t.product.product.name," (",t.product.product.code,") ")}}function lt(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"div",1),l["\u0275\u0275elementStart"](1,"h4"),l["\u0275\u0275text"](2,"Incluir tamb\xe9m:"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](3,"div"),l["\u0275\u0275template"](4,it,2,5,"mat-checkbox",22),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()),2&t){const t=l["\u0275\u0275nextContext"]();l["\u0275\u0275advance"](4),l["\u0275\u0275property"]("ngForOf",t.relatedProducts)}}let st=(()=>{class t{constructor(t,e,n,o,r,a){this._loader=t,this._toast=e,this._dialogRef=n,this._stockService=o,this._productService=r,this.inputData=a,this.productSearchAutocompleteOptions={placeholder:"Produto",onGetItems:t=>this.productSearchAutocompleteOnGetItems(t),onSelectItem:t=>this.productSearchAutocompleteOnSelectItem(t),emitOnClear:!0},this.relatedProducts=[],this.postTypes={types:{in:"in",out:"out"},factor:{in:1,out:-1},list:[{id:"in",label:"Entrada"},{id:"out",label:"Sa\xedda"}]},this.initForm()}ngOnInit(){}initForm(){this.stockForm=new a.g({companyBranchProduct:new a.e(null,a.s.required),type:new a.e(this.postTypes.types.in,a.s.required),quantity:new a.e(null,[a.s.required,a.s.min(1)]),observation:new a.e(null),dateOfIssue:new a.e(R().format("YYYY-MM-DDTHH:mm"),a.s.required)})}productSearchAutocompleteOnGetItems(t){return this._productService.getAllForSales({index:0,limit:8,q:t},this.inputData.companyBranchId).pipe(Object($.a)(t=>t.map(t=>({label:`${t.product.code} - ${t.product.name}`,value:t}))))}productSearchAutocompleteOnSelectItem(t){var e;this.selectedProduct=t.value,this.stockForm.get("companyBranchProduct").setValue((null===(e=t.value)||void 0===e?void 0:e.id)||null),this.selectedProduct?this.getRelatedProducts():this.relatedProducts=[]}getRelatedProducts(){this._productService.getRelated(this.selectedProduct.id).subscribe(t=>{this.relatedProducts=t.map(t=>({product:t.referencedCompanyBranchProduct,selected:t.isDefault}))},t=>{this._toast.showHttpError(t)})}save(){if(!this.stockForm.valid)throw this.stockForm.markAllAsTouched(),this._toast.open("Preencha todos os campos obrigat\xf3rios"),new Error("Invalid form");const t=this.postTypes.types[this.stockForm.get("type").value],e=Number(this.stockForm.get("quantity").value)*this.postTypes.factor[t],n=this.inputData.depositId,o=R(this.stockForm.get("dateOfIssue").value).toISOString(),r=this.stockForm.get("observation").value,a=[{companyBranchProductId:this.selectedProduct.id,depositId:n,quantity:e,dateOfIssue:o,observation:r},...this.relatedProducts.filter(t=>t.selected).map(t=>({companyBranchProductId:t.product.id,depositId:n,quantity:e,dateOfIssue:o,observation:"[Rel.] "+(r||"")}))];this._loader.show(),this._stockService.createPosts(a).subscribe(t=>{this._loader.dismiss(),this._toast.open("Lan\xe7amento salvo!","success"),this._dialogRef.close({hasUpdate:!0})},t=>{this._loader.dismiss(),this._toast.showHttpError(t)})}}return t.\u0275fac=function(e){return new(e||t)(l["\u0275\u0275directiveInject"](s.a),l["\u0275\u0275directiveInject"](c.a),l["\u0275\u0275directiveInject"](i.g),l["\u0275\u0275directiveInject"](L.a),l["\u0275\u0275directiveInject"](H.a),l["\u0275\u0275directiveInject"](i.a))},t.\u0275cmp=l["\u0275\u0275defineComponent"]({type:t,selectors:[["app-stock-post-form"]],decls:38,vars:7,consts:[[1,"row"],[1,"col-sm-12"],[1,"title"],[3,"formGroup"],[1,"col-12"],[3,"options"],["productAutocomplete",""],[1,"col-md-4"],["formControlName","type"],["type",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["matInput","","placeholder","Quantidade","type","number","autocomplete","off","formControlName","quantity"],["quantity",""],["matInput","","type","datetime-local","placeholder","Data","autocomplete","off","formControlName","dateOfIssue"],["dateOfIssue",""],[1,"col-md-12"],["matInput","","placeholder","Observa\xe7\xe3o","autocomplete","off","formControlName","observation"],["observation",""],["class","col-sm-12",4,"ngIf"],["mat-flat-button","","color","primary",2,"margin","24px 0",3,"click"],[3,"value"],[3,"ngModel","ngModelOptions","ngModelChange",4,"ngFor","ngForOf"],[3,"ngModel","ngModelOptions","ngModelChange"]],template:function(t,e){if(1&t&&(l["\u0275\u0275element"](0,"button-dialog-close"),l["\u0275\u0275elementStart"](1,"div",0),l["\u0275\u0275elementStart"](2,"div",1),l["\u0275\u0275elementStart"](3,"h3",2),l["\u0275\u0275text"](4,"Novo lan\xe7amento"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](5,"form",3),l["\u0275\u0275elementStart"](6,"div",0),l["\u0275\u0275elementStart"](7,"div",4),l["\u0275\u0275element"](8,"app-autocomplete",5,6),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](10,"div",7),l["\u0275\u0275elementStart"](11,"mat-form-field"),l["\u0275\u0275elementStart"](12,"mat-label"),l["\u0275\u0275text"](13,"Tipo"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](14,"mat-select",8,9),l["\u0275\u0275template"](16,et,2,2,"mat-option",10),l["\u0275\u0275elementEnd"](),l["\u0275\u0275template"](17,nt,2,0,"mat-error",11),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](18,"div",7),l["\u0275\u0275elementStart"](19,"mat-form-field"),l["\u0275\u0275element"](20,"input",12,13),l["\u0275\u0275template"](22,ot,2,0,"mat-error",11),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](23,"div",7),l["\u0275\u0275elementStart"](24,"mat-form-field"),l["\u0275\u0275element"](25,"input",14,15),l["\u0275\u0275template"](27,rt,2,0,"mat-error",11),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](28,"div",16),l["\u0275\u0275elementStart"](29,"mat-form-field"),l["\u0275\u0275element"](30,"input",17,18),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275element"](32,"hr"),l["\u0275\u0275elementStart"](33,"div",0),l["\u0275\u0275template"](34,lt,5,1,"div",19),l["\u0275\u0275elementStart"](35,"div",1),l["\u0275\u0275elementStart"](36,"button",20),l["\u0275\u0275listener"]("click",function(){return e.save()}),l["\u0275\u0275text"](37,"Salvar"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()),2&t){const t=l["\u0275\u0275reference"](21),n=l["\u0275\u0275reference"](26);l["\u0275\u0275advance"](5),l["\u0275\u0275property"]("formGroup",e.stockForm),l["\u0275\u0275advance"](3),l["\u0275\u0275property"]("options",e.productSearchAutocompleteOptions),l["\u0275\u0275advance"](8),l["\u0275\u0275property"]("ngForOf",e.postTypes.list),l["\u0275\u0275advance"](1),l["\u0275\u0275property"]("ngIf",!e.stockForm.get("type").valid),l["\u0275\u0275advance"](5),l["\u0275\u0275property"]("ngIf",!t.valid),l["\u0275\u0275advance"](5),l["\u0275\u0275property"]("ngIf",!n.valid),l["\u0275\u0275advance"](7),l["\u0275\u0275property"]("ngIf",null==e.relatedProducts?null:e.relatedProducts.length)}},directives:[v.a,a.t,a.n,a.h,G.a,p.c,p.f,h.a,a.m,a.f,o.l,o.m,u.b,a.q,a.d,f.a,g.k,p.b,V.a,a.p],styles:[""]}),t})();var ct=n("iC8P"),dt=n("Qu3c"),mt=n("OJOy");function pt(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"th",26),l["\u0275\u0275text"](1,"Produto"),l["\u0275\u0275elementEnd"]())}function ut(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"td",27),l["\u0275\u0275text"](1),l["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate2"](" ",null==t.depositProduct?null:t.depositProduct.companyBranchProduct.product.name," (",null==t.depositProduct?null:t.depositProduct.companyBranchProduct.product.code,") ")}}function ht(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"th",26),l["\u0275\u0275text"](1,"Tipo"),l["\u0275\u0275elementEnd"]())}function ft(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"td",28),l["\u0275\u0275text"](1),l["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;l["\u0275\u0275styleProp"]("color",t.quantity>0?"var(--color-nephritis)":"var(--color-peterriver)"),l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate1"](" ",t.quantity>0?"Entrada":"Sa\xedda"," ")}}function vt(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"th",26),l["\u0275\u0275text"](1,"Quantidade"),l["\u0275\u0275elementEnd"]())}function gt(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"td",28),l["\u0275\u0275text"](1),l["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate1"](" ",t.quantity," ")}}function St(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"th",26),l["\u0275\u0275text"](1,"Observa\xe7\xe3o"),l["\u0275\u0275elementEnd"]())}function yt(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"td",29),l["\u0275\u0275text"](1),l["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;l["\u0275\u0275property"]("matTooltip",t.observation),l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate1"](" ",t.observation," ")}}function Et(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"th",26),l["\u0275\u0275text"](1,"Data"),l["\u0275\u0275elementEnd"]())}function bt(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"td",27),l["\u0275\u0275text"](1),l["\u0275\u0275pipe"](2,"momentDate"),l["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate1"](" ",l["\u0275\u0275pipeBind2"](2,1,t.dateOfIssue,"DD/MM/YYYY HH:mm")," ")}}function It(t,e){1&t&&l["\u0275\u0275element"](0,"th",26)}function xt(t,e){if(1&t){const t=l["\u0275\u0275getCurrentView"]();l["\u0275\u0275elementStart"](0,"td",27),l["\u0275\u0275elementStart"](1,"a",30),l["\u0275\u0275listener"]("click",function(){l["\u0275\u0275restoreView"](t);const n=e.$implicit;return l["\u0275\u0275nextContext"]().deletePost(n)}),l["\u0275\u0275elementStart"](2,"mat-icon"),l["\u0275\u0275text"](3,"delete"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()}}function wt(t,e){1&t&&l["\u0275\u0275element"](0,"tr",31)}function Ct(t,e){1&t&&l["\u0275\u0275element"](0,"tr",32)}function _t(t,e){if(1&t){const t=l["\u0275\u0275getCurrentView"]();l["\u0275\u0275elementStart"](0,"button",33),l["\u0275\u0275listener"]("click",function(){return l["\u0275\u0275restoreView"](t),l["\u0275\u0275nextContext"]().loadMore()}),l["\u0275\u0275text"](1,"Mais..."),l["\u0275\u0275elementEnd"]()}}function Pt(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"tr"),l["\u0275\u0275elementStart"](1,"td"),l["\u0275\u0275text"](2),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](3,"td"),l["\u0275\u0275text"](4),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;l["\u0275\u0275advance"](2),l["\u0275\u0275textInterpolate2"](" ",t.companyBranchProduct.product.name," (",t.companyBranchProduct.product.code,") "),l["\u0275\u0275advance"](2),l["\u0275\u0275textInterpolate"](t.quantity)}}function Ot(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"table",34),l["\u0275\u0275elementStart"](1,"thead"),l["\u0275\u0275elementStart"](2,"tr"),l["\u0275\u0275elementStart"](3,"th"),l["\u0275\u0275text"](4,"Produto"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](5,"th"),l["\u0275\u0275text"](6,"Quantidade"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](7,"tbody"),l["\u0275\u0275template"](8,Pt,5,3,"tr",35),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()),2&t){const t=l["\u0275\u0275nextContext"]();l["\u0275\u0275advance"](8),l["\u0275\u0275property"]("ngForOf",t.deposit.products)}}let kt=(()=>{class t{constructor(t,e,n,o,r,a,i){this._toast=t,this._loader=e,this._stockService=n,this._dialog=o,this._alert=r,this._productService=a,this.inputData=i,this.stockPosts=[],this.tableColumns=["product","type","quantity","observation","createdAt","options"],this.productSearchAutocompleteOptions={placeholder:"Produto",onGetItems:t=>this.productSearchAutocompleteOnGetItems(t),onSelectItem:t=>this.productSearchAutocompleteOnSelectItem(t),emitOnClear:!0},this.filter={index:0,limit:40,depositId:i.depositId}}ngOnInit(){this.refresh()}refresh(){this._loader.show(),Promise.all([this.getDeposit(),this.getPosts()]).then(()=>this._loader.dismiss()).catch(()=>this._loader.dismiss())}getDeposit(t={}){return new Promise((e,n)=>{(null==t?void 0:t.showLoader)&&this._loader.show(),this._stockService.getDepositById(this.inputData.depositId).subscribe(n=>{(null==t?void 0:t.showLoader)&&this._loader.dismiss(),this.deposit=n,e()},e=>{(null==t?void 0:t.showLoader)&&this._loader.dismiss(),this._toast.showHttpError(e),n()})})}getPosts(t={}){return new Promise((e,n)=>{(null==t?void 0:t.showLoader)&&this._loader.show(),this._stockService.getPosts(this.filter).subscribe(n=>{(null==t?void 0:t.showLoader)&&this._loader.dismiss(),this.stockPosts=(null==t?void 0:t.concat)?this.stockPosts.concat(n):n,e()},e=>{(null==t?void 0:t.showLoader)&&this._loader.dismiss(),this._toast.showHttpError(e),n()})})}openPostForm(){this._dialog.open(st,{width:"50%",height:"80%",data:{companyBranchId:this.inputData.companyBranchId,depositId:this.deposit.id}}).afterClosed().subscribe(t=>{t&&t.hasUpdate&&this.refresh()})}productSearchAutocompleteOnGetItems(t){return this._productService.getAllForSales({index:0,limit:8,q:t},this.inputData.companyBranchId).pipe(Object($.a)(t=>t.map(t=>({label:`${t.product.code} - ${t.product.name}`,value:t}))))}productSearchAutocompleteOnSelectItem(t){var e;this.selectedProduct=t.value,this.filter.companyBranchProductId=null===(e=this.selectedProduct)||void 0===e?void 0:e.id,this.filterProduct()}loadMore(){this.filter.index++,this.getPosts({concat:!0})}filterProduct(){this.filter.index=0,this.getPosts({showLoader:!0})}deletePost(t){this._alert.open({message:`Excluir lan\xe7amento #${t.id}? \u{1f615}`,title:"#"+t.id,buttons:[{text:"Cancelar",closeOnClick:!0},{text:"Excluir",color:"warn",onClick:()=>{this._loader.show(),this._stockService.deletePost(t.id).subscribe(t=>{this._loader.dismiss(),this._toast.open("Exclu\xeddo com sucesso","success"),this.refresh()},t=>{this._loader.dismiss(),this._toast.showHttpError(t)})}}]})}}return t.\u0275fac=function(e){return new(e||t)(l["\u0275\u0275directiveInject"](c.a),l["\u0275\u0275directiveInject"](s.a),l["\u0275\u0275directiveInject"](L.a),l["\u0275\u0275directiveInject"](i.b),l["\u0275\u0275directiveInject"](ct.a),l["\u0275\u0275directiveInject"](H.a),l["\u0275\u0275directiveInject"](i.a))},t.\u0275cmp=l["\u0275\u0275defineComponent"]({type:t,selectors:[["app-stock-posts"]],decls:39,vars:7,consts:[[2,"font-size","24px","margin","16px"],[1,"row"],[1,"col-md-8"],[2,"display","flex","gap","48px","align-items","center"],[2,"font-size","18px"],["mat-flat-button","","color","primary",2,"width","40%",3,"click"],[2,"width","100%",3,"options"],["productAutocomplete",""],["mat-table","",2,"width","100%",3,"dataSource"],["matColumnDef","product"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","type"],["mat-cell","","style","font-weight: bold;",3,"color",4,"matCellDef"],["matColumnDef","quantity"],["mat-cell","","style","font-weight: bold;",4,"matCellDef"],["matColumnDef","observation"],["mat-cell","",3,"matTooltip",4,"matCellDef"],["matColumnDef","createdAt"],["matColumnDef","options"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[2,"text-align","center","padding","10px"],["mat-flat-button","","color","primary",3,"click",4,"ngIf"],[1,"col-md-4"],["class","stock-table",4,"ngIf"],["mat-header-cell",""],["mat-cell",""],["mat-cell","",2,"font-weight","bold"],["mat-cell","",3,"matTooltip"],["href","javascript:;",3,"click"],["mat-header-row",""],["mat-row",""],["mat-flat-button","","color","primary",3,"click"],[1,"stock-table"],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(l["\u0275\u0275element"](0,"button-dialog-close"),l["\u0275\u0275elementStart"](1,"h1",0),l["\u0275\u0275text"](2),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](3,"div",1),l["\u0275\u0275elementStart"](4,"div",2),l["\u0275\u0275elementStart"](5,"div",3),l["\u0275\u0275elementStart"](6,"h2",4),l["\u0275\u0275text"](7,"Lan\xe7amentos"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](8,"button",5),l["\u0275\u0275listener"]("click",function(){return e.openPostForm()}),l["\u0275\u0275text"](9,"Novo lan\xe7amento"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275element"](10,"app-autocomplete",6,7),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](12,"table",8),l["\u0275\u0275elementContainerStart"](13,9),l["\u0275\u0275template"](14,pt,2,0,"th",10),l["\u0275\u0275template"](15,ut,2,2,"td",11),l["\u0275\u0275elementContainerEnd"](),l["\u0275\u0275elementContainerStart"](16,12),l["\u0275\u0275template"](17,ht,2,0,"th",10),l["\u0275\u0275template"](18,ft,2,3,"td",13),l["\u0275\u0275elementContainerEnd"](),l["\u0275\u0275elementContainerStart"](19,14),l["\u0275\u0275template"](20,vt,2,0,"th",10),l["\u0275\u0275template"](21,gt,2,1,"td",15),l["\u0275\u0275elementContainerEnd"](),l["\u0275\u0275elementContainerStart"](22,16),l["\u0275\u0275template"](23,St,2,0,"th",10),l["\u0275\u0275template"](24,yt,2,2,"td",17),l["\u0275\u0275elementContainerEnd"](),l["\u0275\u0275elementContainerStart"](25,18),l["\u0275\u0275template"](26,Et,2,0,"th",10),l["\u0275\u0275template"](27,bt,3,4,"td",11),l["\u0275\u0275elementContainerEnd"](),l["\u0275\u0275elementContainerStart"](28,19),l["\u0275\u0275template"](29,It,1,0,"th",10),l["\u0275\u0275template"](30,xt,4,0,"td",11),l["\u0275\u0275elementContainerEnd"](),l["\u0275\u0275template"](31,wt,1,0,"tr",20),l["\u0275\u0275template"](32,Ct,1,0,"tr",21),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](33,"div",22),l["\u0275\u0275template"](34,_t,2,0,"button",23),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](35,"div",24),l["\u0275\u0275elementStart"](36,"h2",4),l["\u0275\u0275text"](37,"Total"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275template"](38,Ot,9,1,"table",25),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()),2&t&&(l["\u0275\u0275advance"](2),l["\u0275\u0275textInterpolate"](null==e.deposit?null:e.deposit.name),l["\u0275\u0275advance"](8),l["\u0275\u0275property"]("options",e.productSearchAutocompleteOptions),l["\u0275\u0275advance"](2),l["\u0275\u0275property"]("dataSource",e.stockPosts),l["\u0275\u0275advance"](19),l["\u0275\u0275property"]("matHeaderRowDef",e.tableColumns),l["\u0275\u0275advance"](1),l["\u0275\u0275property"]("matRowDefColumns",e.tableColumns),l["\u0275\u0275advance"](2),l["\u0275\u0275property"]("ngIf",e.stockPosts.length>=e.filter.limit),l["\u0275\u0275advance"](4),l["\u0275\u0275property"]("ngIf",null==e.deposit?null:e.deposit.products.length))},directives:[v.a,f.a,G.a,_.j,_.c,_.e,_.b,_.g,_.i,o.m,_.d,_.a,dt.a,P.a,_.f,_.h,o.l],pipes:[mt.a],styles:[".stock-table[_ngcontent-%COMP%]{width:100%}.stock-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid #ddd}.stock-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .stock-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{max-width:calc(100vw / 10);white-space:nowrap;word-wrap:break-word;overflow:hidden;text-overflow:ellipsis}.stock-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:0 7px}"]}),t})();var Dt=n("Wp6s");function Ft(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"mat-option",13),l["\u0275\u0275text"](1),l["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;l["\u0275\u0275property"]("value",t.id),l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate2"](" ",t.tradeName," - ",t.name," ")}}function Mt(t,e){if(1&t){const t=l["\u0275\u0275getCurrentView"]();l["\u0275\u0275elementStart"](0,"button",14),l["\u0275\u0275listener"]("click",function(){return l["\u0275\u0275restoreView"](t),l["\u0275\u0275nextContext"]().openDepositTransfer()}),l["\u0275\u0275text"](1," Transfer\xeancia de estoque "),l["\u0275\u0275elementStart"](2,"mat-icon"),l["\u0275\u0275text"](3,"swap_horiz"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()}}function Bt(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"tr"),l["\u0275\u0275elementStart"](1,"td"),l["\u0275\u0275text"](2),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](3,"td"),l["\u0275\u0275text"](4),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;l["\u0275\u0275advance"](2),l["\u0275\u0275textInterpolate2"](" ",t.companyBranchProduct.product.name," (",t.companyBranchProduct.product.code,") "),l["\u0275\u0275advance"](2),l["\u0275\u0275textInterpolate"](t.quantity)}}function jt(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"table",19),l["\u0275\u0275elementStart"](1,"thead"),l["\u0275\u0275elementStart"](2,"tr"),l["\u0275\u0275elementStart"](3,"th"),l["\u0275\u0275text"](4,"Produto"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](5,"th"),l["\u0275\u0275text"](6,"Quantidade"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](7,"tbody"),l["\u0275\u0275template"](8,Bt,5,3,"tr",20),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()),2&t){const t=l["\u0275\u0275nextContext"]().$implicit;l["\u0275\u0275advance"](8),l["\u0275\u0275property"]("ngForOf",t.products)}}function qt(t,e){if(1&t){const t=l["\u0275\u0275getCurrentView"]();l["\u0275\u0275elementStart"](0,"div",15),l["\u0275\u0275elementStart"](1,"mat-card"),l["\u0275\u0275elementStart"](2,"mat-card-header"),l["\u0275\u0275elementStart"](3,"mat-card-title",16),l["\u0275\u0275text"](4),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](5,"mat-card-content"),l["\u0275\u0275template"](6,jt,9,1,"table",17),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](7,"mat-card-actions"),l["\u0275\u0275elementStart"](8,"button",18),l["\u0275\u0275listener"]("click",function(){l["\u0275\u0275restoreView"](t);const n=e.$implicit;return l["\u0275\u0275nextContext"]().openStockPosts(n.id)}),l["\u0275\u0275text"](9,"Lan\xe7amentos"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()}if(2&t){const t=e.$implicit;l["\u0275\u0275advance"](4),l["\u0275\u0275textInterpolate"](t.name),l["\u0275\u0275advance"](2),l["\u0275\u0275property"]("ngIf",t.products.length)}}function At(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"tr"),l["\u0275\u0275elementStart"](1,"td"),l["\u0275\u0275text"](2),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](3,"td"),l["\u0275\u0275text"](4),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;l["\u0275\u0275advance"](2),l["\u0275\u0275textInterpolate2"](" ",t.product.product.name," (",t.product.product.code,") "),l["\u0275\u0275advance"](2),l["\u0275\u0275textInterpolate"](t.quantity)}}function Tt(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"div",21),l["\u0275\u0275elementStart"](1,"h5"),l["\u0275\u0275text"](2,"Total"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](3,"table",19),l["\u0275\u0275elementStart"](4,"thead"),l["\u0275\u0275elementStart"](5,"tr"),l["\u0275\u0275elementStart"](6,"th"),l["\u0275\u0275text"](7,"Produto"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](8,"th"),l["\u0275\u0275text"](9,"Quantidade"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](10,"tbody"),l["\u0275\u0275template"](11,At,5,3,"tr",20),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()),2&t){const t=l["\u0275\u0275nextContext"]();l["\u0275\u0275advance"](11),l["\u0275\u0275property"]("ngForOf",t.productsTotals)}}let Nt=(()=>{class t{constructor(t,e,n,o,r,a){this._title=t,this._toast=e,this._loader=n,this._stockService=o,this._companyBranchService=r,this._dialog=a,this.companyBranches=[],this.deposits=[],this.productsTotals=[]}ngOnInit(){this._title.set("Controle de estoque"),this.getCompanyBranches()}getStockDeposits(t={}){(null==t?void 0:t.showLoader)&&this._loader.show(),this._stockService.getDeposits(Number(this.companyBranchIdValue)).subscribe(e=>{(null==t?void 0:t.showLoader)&&this._loader.dismiss(),this.deposits=e,this.calculeProductsTotals()},e=>{(null==t?void 0:t.showLoader)&&this._loader.dismiss(),this._toast.showHttpError(e)})}getCompanyBranches(){this._companyBranchService.getAll().subscribe(t=>{this.companyBranches=t},t=>{this._toast.showHttpError(t)})}openStockPosts(t){const e={depositId:t,companyBranchId:Number(this.companyBranchIdValue)};this._dialog.open(kt,{maxWidth:"90%",width:"90%",height:"90%",data:e}).afterClosed().subscribe(t=>{this.getStockDeposits()})}openDepositTransfer(){const t={companyBranchId:Number(this.companyBranchIdValue)};this._dialog.open(tt,{width:"50%",height:"80%",data:t}).afterClosed().subscribe(t=>{this.getStockDeposits()})}calculeProductsTotals(){this.deposits.forEach(t=>{t.products.forEach(t=>{const e=this.productsTotals.find(e=>e.product.id==t.companyBranchProduct.id);!e&&t.quantity>0?this.productsTotals.push({product:t.companyBranchProduct,quantity:t.quantity}):t.quantity>0&&(e.quantity+=t.quantity)})})}}return t.\u0275fac=function(e){return new(e||t)(l["\u0275\u0275directiveInject"](C.a),l["\u0275\u0275directiveInject"](c.a),l["\u0275\u0275directiveInject"](s.a),l["\u0275\u0275directiveInject"](L.a),l["\u0275\u0275directiveInject"](m.a),l["\u0275\u0275directiveInject"](i.b))},t.\u0275cmp=l["\u0275\u0275defineComponent"]({type:t,selectors:[["app-stock-control"]],decls:19,vars:6,consts:[[2,"font-size","32px","margin","16px"],[1,"row"],[1,"col-md-12"],[2,"display","flex","gap","48px","align-items","center"],[2,"width","50%"],[3,"ngModel","ngModelChange","selectionChange"],["companyBranch",""],[3,"value",4,"ngFor","ngForOf"],["mat-flat-button","","color","primary",3,"disabled","click"],["mat-stroked-button","","color","primary",3,"click",4,"ngIf"],[1,"col-md-9"],["class","col-md-4","style","margin-bottom: 24px;",4,"ngFor","ngForOf"],["class","col-3",4,"ngIf"],[3,"value"],["mat-stroked-button","","color","primary",3,"click"],[1,"col-md-4",2,"margin-bottom","24px"],[2,"font-weight","bold"],["class","stock-table",4,"ngIf"],["mat-button","",3,"click"],[1,"stock-table"],[4,"ngFor","ngForOf"],[1,"col-3"]],template:function(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"h1",0),l["\u0275\u0275text"](1,"Controle de estoque"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](2,"div",1),l["\u0275\u0275elementStart"](3,"div",2),l["\u0275\u0275elementStart"](4,"div",3),l["\u0275\u0275elementStart"](5,"mat-form-field",4),l["\u0275\u0275elementStart"](6,"mat-label"),l["\u0275\u0275text"](7,"Unidade"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](8,"mat-select",5,6),l["\u0275\u0275listener"]("ngModelChange",function(t){return e.companyBranchIdValue=t})("selectionChange",function(){return e.getStockDeposits({showLoader:!0})}),l["\u0275\u0275template"](10,Ft,2,3,"mat-option",7),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](11,"button",8),l["\u0275\u0275listener"]("click",function(){return e.getStockDeposits({showLoader:!0})}),l["\u0275\u0275text"](12,"Atualizar"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275template"](13,Mt,4,0,"button",9),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](14,"div",1),l["\u0275\u0275elementStart"](15,"div",10),l["\u0275\u0275elementStart"](16,"div",1),l["\u0275\u0275template"](17,qt,10,2,"div",11),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275template"](18,Tt,12,1,"div",12),l["\u0275\u0275elementEnd"]()),2&t){const t=l["\u0275\u0275reference"](9);l["\u0275\u0275advance"](8),l["\u0275\u0275property"]("ngModel",e.companyBranchIdValue),l["\u0275\u0275advance"](2),l["\u0275\u0275property"]("ngForOf",e.companyBranches),l["\u0275\u0275advance"](1),l["\u0275\u0275property"]("disabled",!t.value),l["\u0275\u0275advance"](2),l["\u0275\u0275property"]("ngIf",t.value),l["\u0275\u0275advance"](4),l["\u0275\u0275property"]("ngForOf",e.deposits),l["\u0275\u0275advance"](1),l["\u0275\u0275property"]("ngIf",e.deposits.length)}},directives:[p.c,p.f,h.a,a.m,a.p,o.l,f.a,o.m,g.k,P.a,Dt.a,Dt.d,Dt.g,Dt.c,Dt.b],styles:[".stock-table[_ngcontent-%COMP%]{width:100%}.stock-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid #ddd}.stock-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .stock-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:6px}"]}),t})();const $t=[{path:"",component:(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l["\u0275\u0275defineComponent"]({type:t,selectors:[["app-stock"]],decls:1,vars:0,template:function(t,e){1&t&&l["\u0275\u0275element"](0,"router-outlet")},directives:[r.h],styles:[""]}),t})(),children:[{path:"deposits",component:N},{path:"stock-control",component:Nt}]}];let Rt=(()=>{class t{}return t.\u0275mod=l["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=l["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[r.g.forChild($t)],r.g]}),t})();var Lt=n("ssao"),Ht=n("PCNd"),Gt=n("iTUp");let Vt=(()=>{class t{}return t.\u0275mod=l["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=l["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[o.c,Lt.a,Rt,Ht.a,a.r,a.i,Gt.a]]}),t})()}}]);